// test_advanced_features.qb
// ê³ ê¸‰ ê¸°ëŠ¥ë“¤ì˜ ì‹¤ì œ êµ¬í˜„ ìƒíƒœ í…ŒìŠ¤íŠ¸

fn main() {
    println("ğŸ”¬ ê³ ê¸‰ ê¸°ëŠ¥ êµ¬í˜„ ìƒíƒœ ì¡°ì‚¬");
    println("==========================");
    
    // 1. ì–‘ì ë ˆì§€ìŠ¤í„° ë¬¸ë²• í…ŒìŠ¤íŠ¸
    println("1. ì–‘ì ë ˆì§€ìŠ¤í„° ë¬¸ë²• í…ŒìŠ¤íŠ¸");
    test_quantum_registers();
    
    // 2. ê³ ì „ ë ˆì§€ìŠ¤í„° ë¬¸ë²• í…ŒìŠ¤íŠ¸
    println("\n2. ê³ ì „ ë ˆì§€ìŠ¤í„° ë¬¸ë²• í…ŒìŠ¤íŠ¸");
    test_classical_registers();
    
    // 3. ì¡°ê±´ë¶€ ì‹¤í–‰ í…ŒìŠ¤íŠ¸
    println("\n3. ì¡°ê±´ë¶€ ì‹¤í–‰ í…ŒìŠ¤íŠ¸");
    test_conditional_execution();
    
    // 4. ì–‘ì ì„œë¸Œë£¨í‹´ í…ŒìŠ¤íŠ¸
    println("\n4. ì–‘ì ì„œë¸Œë£¨í‹´ í…ŒìŠ¤íŠ¸");
    test_quantum_subroutines();
    
    // 5. ê³ ê¸‰ ì¸¡ì • ê¸°ëŠ¥ í…ŒìŠ¤íŠ¸
    println("\n5. ê³ ê¸‰ ì¸¡ì • ê¸°ëŠ¥ í…ŒìŠ¤íŠ¸");
    test_advanced_measurement();
    
    // 6. ê¸°íƒ€ ì‹¤í—˜ì  ê¸°ëŠ¥ í…ŒìŠ¤íŠ¸
    println("\n6. ê¸°íƒ€ ì‹¤í—˜ì  ê¸°ëŠ¥ í…ŒìŠ¤íŠ¸");
    test_experimental_features();
}

fn test_quantum_registers() {
    // í…ŒìŠ¤íŠ¸: qreg[8] data; ë¬¸ë²•
    try {
        // ì´ëŸ° ë¬¸ë²•ì´ ì§€ì›ë˜ëŠ”ì§€ í™•ì¸
        println("qreg[8] data; ë¬¸ë²• í…ŒìŠ¤íŠ¸ ì¤‘...");
        
        // ëŒ€ì•ˆ ë¬¸ë²•ë“¤ë„ í…ŒìŠ¤íŠ¸
        println("Array<qubit> ë¬¸ë²• í…ŒìŠ¤íŠ¸ ì¤‘...");
        
        // í˜„ì¬ ì§€ì›ë˜ëŠ” ë°©ì‹ í™•ì¸
        circuit TestQReg(8) {
            apply H to q0;
            apply H to q1;
            apply H to q2;
            apply H to q3;
            apply H to q4;
            apply H to q5;
            apply H to q6;
            apply H to q7;
        }
        
        qreg_test = TestQReg();
        println("âœ… ê¸°ë³¸ 8íë¹— ë ˆì§€ìŠ¤í„° ì„±ê³µ");
        
    } catch (error) {
        println("âŒ ì–‘ì ë ˆì§€ìŠ¤í„° í…ŒìŠ¤íŠ¸ ì‹¤íŒ¨: {}", error);
    }
}

fn test_classical_registers() {
    // í…ŒìŠ¤íŠ¸: creg[8] result; ë¬¸ë²•
    try {
        println("creg[8] result; ë¬¸ë²• í…ŒìŠ¤íŠ¸ ì¤‘...");
        
        // ê¸°ë³¸ ë°°ì—´ ë°©ì‹ìœ¼ë¡œ í…ŒìŠ¤íŠ¸
        result_array = [0, 0, 0, 0, 0, 0, 0, 0];
        println("âœ… ê¸°ë³¸ ë°°ì—´ ë°©ì‹ ì„±ê³µ: {}", result_array);
        
    } catch (error) {
        println("âŒ ê³ ì „ ë ˆì§€ìŠ¤í„° í…ŒìŠ¤íŠ¸ ì‹¤íŒ¨: {}", error);
    }
}

fn test_conditional_execution() {
    // í…ŒìŠ¤íŠ¸: if (measurement == 1) apply X to q0;
    try {
        println("ì¡°ê±´ë¶€ ê²Œì´íŠ¸ ì ìš© í…ŒìŠ¤íŠ¸ ì¤‘...");
        
        circuit TestConditional(2) {
            apply H to q0;
            apply CNOT to (q0, q1);
            
            // ì´ëŸ° ë¬¸ë²•ì´ ì§€ì›ë˜ëŠ”ì§€ í™•ì¸
            // if (measure q0 == 1) apply X to q1;
        }
        
        conditional_test = TestConditional();
        result = measure(conditional_test, [0, 1]);
        
        // ìˆ˜ë™ ì¡°ê±´ë¶€ ì‹¤í–‰ í…ŒìŠ¤íŠ¸
        if result[0] == 1 {
            println("âœ… ìˆ˜ë™ ì¡°ê±´ë¶€ ì‹¤í–‰ ê°€ëŠ¥");
        }
        
    } catch (error) {
        println("âŒ ì¡°ê±´ë¶€ ì‹¤í–‰ í…ŒìŠ¤íŠ¸ ì‹¤íŒ¨: {}", error);
    }
}

fn test_quantum_subroutines() {
    // í…ŒìŠ¤íŠ¸: call grover_oracle(target_state);
    try {
        println("ì–‘ì ì„œë¸Œë£¨í‹´ í˜¸ì¶œ í…ŒìŠ¤íŠ¸ ì¤‘...");
        
        // í•¨ìˆ˜ í˜¸ì¶œ ë°©ì‹ìœ¼ë¡œ í…ŒìŠ¤íŠ¸
        oracle_result = test_oracle_function([1, 0, 1]);
        println("âœ… í•¨ìˆ˜ ë°©ì‹ ì„œë¸Œë£¨í‹´ ì„±ê³µ: {}", oracle_result);
        
    } catch (error) {
        println("âŒ ì–‘ì ì„œë¸Œë£¨í‹´ í…ŒìŠ¤íŠ¸ ì‹¤íŒ¨: {}", error);
    }
}

fn test_oracle_function(target_state) {
    // ê°„ë‹¨í•œ Oracle í•¨ìˆ˜ ì˜ˆì œ
    return target_state;
}

fn test_advanced_measurement() {
    try {
        println("ê³ ê¸‰ ì¸¡ì • ê¸°ëŠ¥ í…ŒìŠ¤íŠ¸ ì¤‘...");
        
        circuit TestAdvMeasure(3) {
            apply H to q0;
            apply H to q1;
            apply H to q2;
            apply CZ to (q0, q1, q2);
        }
        
        adv_circuit = TestAdvMeasure();
        
        // ë‹¤ì–‘í•œ ì¸¡ì • ë°©ì‹ í…ŒìŠ¤íŠ¸
        
        // 1. ì „ì²´ ì¸¡ì •
        full_result = measure(adv_circuit, [0, 1, 2]);
        println("ì „ì²´ ì¸¡ì •: {}", full_result);
        
        // 2. ë¶€ë¶„ ì¸¡ì •
        partial_result = measure(adv_circuit, [0, 2]);
        println("ë¶€ë¶„ ì¸¡ì •: {}", partial_result);
        
        // 3. ë‹¨ì¼ ì¸¡ì •
        single_result = measure(adv_circuit, [1]);
        println("ë‹¨ì¼ ì¸¡ì •: {}", single_result);
        
        println("âœ… ë‹¤ì–‘í•œ ì¸¡ì • ë°©ì‹ ëª¨ë‘ ì„±ê³µ");
        
    } catch (error) {
        println("âŒ ê³ ê¸‰ ì¸¡ì • í…ŒìŠ¤íŠ¸ ì‹¤íŒ¨: {}", error);
    }
}

fn test_experimental_features() {
    try {
        println("ì‹¤í—˜ì  ê¸°ëŠ¥ë“¤ í…ŒìŠ¤íŠ¸ ì¤‘...");
        
        // 1. ë³µí•© ê²Œì´íŠ¸ í…ŒìŠ¤íŠ¸
        circuit TestComplex(4) {
            // ë³µì¡í•œ ê²Œì´íŠ¸ ì¡°í•©
            apply H to q0;
            apply CNOT to (q0, q1);
            apply CCZ to (q0, q1, q2);
            apply CCCZ to (q0, q1, q2, q3);
        }
        
        complex_test = TestComplex();
        println("âœ… ë³µí•© ê²Œì´íŠ¸ ì„±ê³µ");
        
        // 2. ê³ ê¸‰ ìƒìˆ˜ í…ŒìŠ¤íŠ¸
        pi_value = Ï€;
        e_value = e;
        phi_value = Ï†;
        
        println("âœ… ìˆ˜í•™ ìƒìˆ˜ë“¤ ì‚¬ìš© ê°€ëŠ¥:");
        println("  Ï€ = {}", pi_value);
        println("  e = {}", e_value);
        println("  Ï† = {}", phi_value);
        
        // 3. ë³µì†Œìˆ˜ í…ŒìŠ¤íŠ¸
        complex_num = 1.0 + 2.0i;
        println("âœ… ë³µì†Œìˆ˜ ì§€ì›: {}", complex_num);
        
    } catch (error) {
        println("âŒ ì‹¤í—˜ì  ê¸°ëŠ¥ í…ŒìŠ¤íŠ¸ ì‹¤íŒ¨: {}", error);
    }
}

// ì¶”ê°€: ì—ëŸ¬ ê²½ê³„ í…ŒìŠ¤íŠ¸
fn test_error_boundaries() {
    println("\nğŸš¨ ì—ëŸ¬ ê²½ê³„ í…ŒìŠ¤íŠ¸");
    println("==================");
    
    // ë©”ëª¨ë¦¬ í•œê³„ í…ŒìŠ¤íŠ¸
    try {
        println("í° íšŒë¡œ ìƒì„± í…ŒìŠ¤íŠ¸ (15íë¹—)...");
        circuit BigCircuit(15) {
            apply H to q0;
            apply H to q14;
        }
        big_test = BigCircuit();
        println("âœ… 15íë¹— íšŒë¡œ ì„±ê³µ");
        
    } catch (error) {
        println("âŒ 15íë¹— íšŒë¡œ ì‹¤íŒ¨: {}", error);
    }
    
    // ê·¹í•œ í…ŒìŠ¤íŠ¸
    try {
        println("ê·¹í•œ í…ŒìŠ¤íŠ¸ (20íë¹—)...");
        circuit HugeCircuit(20) {
            apply H to q0;
            apply H to q19;
        }
        huge_test = HugeCircuit();
        println("âœ… 20íë¹— íšŒë¡œ ì„±ê³µ");
        
    } catch (error) {
        println("âŒ 20íë¹— íšŒë¡œ ì‹¤íŒ¨: {}", error);
    }
}