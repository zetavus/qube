// ì˜¬ë°”ë¥¸ Deutsch-Jozsa ì•Œê³ ë¦¬ì¦˜ (2íë¹— ì¸¡ì •)

fn oracle_constant_0() {
    println("    Oracle: f(x) = 0 (ìƒìˆ˜í•¨ìˆ˜)");
    // ì•„ë¬´ê²ƒë„ í•˜ì§€ ì•ŠìŒ
}

fn oracle_constant_1() {
    println("    Oracle: f(x) = 1 (ìƒìˆ˜í•¨ìˆ˜)");
    apply X to q1;
}

fn oracle_balanced_identity() {
    println("    Oracle: f(x) = x (ê· í˜•í•¨ìˆ˜)");  
    apply CNOT to (q0, q1);
}

fn oracle_balanced_not() {
    println("    Oracle: f(x) = NOT x (ê· í˜•í•¨ìˆ˜)");
    apply X to q0;
    apply CNOT to (q0, q1);
    apply X to q0;
}

fn analyze_2qubit_result(result, expected_type, test_name) {
    println("  ì¸¡ì • ê²°ê³¼: {}", result);
    
    // 2íë¹— ê²°ê³¼ ë¶„ì„: [ì²«ë²ˆì§¸, ë‘ë²ˆì§¸]
    if (result[0] == 0 && result[1] == 0) {
        println("  ğŸ“Š ê²°ê³¼: 00 â†’ ìƒìˆ˜í•¨ìˆ˜");
        if (expected_type == 0) {
            println("  âœ… {} ì„±ê³µ!", test_name);
            return true;
        } else {
            println("  âŒ {} ì‹¤íŒ¨", test_name);
            return false;
        }
    } else {
        if (result[0] == 0 && result[1] == 1) {
            println("  ğŸ“Š ê²°ê³¼: 01 â†’ ê· í˜•í•¨ìˆ˜");
        } else {
            println("  ğŸ“Š ê²°ê³¼: {} â†’ ì˜ˆìƒì™¸ ê²°ê³¼", result);
        }
        
        if (expected_type == 1) {
            println("  âœ… {} ì„±ê³µ!", test_name);
            return true;
        } else {
            println("  âŒ {} ì‹¤íŒ¨", test_name);
            return false;
        }
    }
}

fn test_constant_0() {
    println("í…ŒìŠ¤íŠ¸ 1: f(x) = 0 (ìƒìˆ˜í•¨ìˆ˜)");
    
    circuit TestConstant0(2) {
        apply X to q1;
        apply H to ~;
        oracle_constant_0();
        apply H to q0;
    }
    
    circuit1 = TestConstant0(2);
    result1 = measure(circuit1, [0, 1]);  // 2íë¹— ëª¨ë‘ ì¸¡ì •
    
    return analyze_2qubit_result(result1, 0, "ìƒìˆ˜í•¨ìˆ˜ f(x)=0");
}

fn test_constant_1() {
    println("í…ŒìŠ¤íŠ¸ 2: f(x) = 1 (ìƒìˆ˜í•¨ìˆ˜)");
    
    circuit TestConstant1(2) {
        apply X to q1;
        apply H to ~;
        oracle_constant_1();
        apply H to q0;
    }
    
    circuit2 = TestConstant1(2);
    result2 = measure(circuit2, [0, 1]);  // 2íë¹— ëª¨ë‘ ì¸¡ì •
    
    return analyze_2qubit_result(result2, 0, "ìƒìˆ˜í•¨ìˆ˜ f(x)=1");
}

fn test_balanced_identity() {
    println("í…ŒìŠ¤íŠ¸ 3: f(x) = x (ê· í˜•í•¨ìˆ˜)");
    
    circuit TestBalancedId(2) {
        apply X to q1;
        apply H to ~;
        oracle_balanced_identity();
        apply H to q0;
    }
    
    circuit3 = TestBalancedId(2);
    result3 = measure(circuit3, [0, 1]);  // 2íë¹— ëª¨ë‘ ì¸¡ì •
    
    return analyze_2qubit_result(result3, 1, "ê· í˜•í•¨ìˆ˜ f(x)=x");
}

fn test_balanced_not() {
    println("í…ŒìŠ¤íŠ¸ 4: f(x) = NOT x (ê· í˜•í•¨ìˆ˜)");
    
    circuit TestBalancedNot(2) {
        apply X to q1;
        apply H to ~;
        oracle_balanced_not();
        apply H to q0;
    }
    
    circuit4 = TestBalancedNot(2);
    result4 = measure(circuit4, [0, 1]);  // 2íë¹— ëª¨ë‘ ì¸¡ì •
    
    return analyze_2qubit_result(result4, 1, "ê· í˜•í•¨ìˆ˜ f(x)=NOT x");
}

fn run_corrected_tests() {
    println("ğŸ§ª ì˜¬ë°”ë¥¸ Deutsch-Jozsa í…ŒìŠ¤íŠ¸ (2íë¹— ì¸¡ì •)");
    println("==========================================");
    println("ì´ë¡ : ìƒìˆ˜í•¨ìˆ˜ â†’ 00, ê· í˜•í•¨ìˆ˜ â†’ 01");
    println("");
    
    success_count = 0;
    
    if (test_constant_0()) {
        success_count = success_count + 1;
    }
    println("");
    
    if (test_constant_1()) {
        success_count = success_count + 1;
    }
    println("");
    
    if (test_balanced_identity()) {
        success_count = success_count + 1;
    }
    println("");
    
    if (test_balanced_not()) {
        success_count = success_count + 1;
    }
    println("");
    
    success_rate = (success_count * 100) / 4;
    
    println("ğŸ† ìµœì¢… ê²°ê³¼:");
    println("============");
    println("ì„±ê³µ: {} / 4 í…ŒìŠ¤íŠ¸", success_count);
    println("ì„±ê³µë¥ : {}%", success_rate);
    
    return success_rate;
}

fn main() {
    println("ğŸŒŸ ì˜¬ë°”ë¥¸ Deutsch-Jozsa ì•Œê³ ë¦¬ì¦˜");
    println("===============================");
    println("ëª©ì : í•¨ìˆ˜ê°€ ìƒìˆ˜ì¸ì§€ ê· í˜•ì¸ì§€ 1ë²ˆ í˜¸ì¶œë¡œ íŒë³„");
    println("í•µì‹¬: 2íë¹— ëª¨ë‘ ì¸¡ì •í•´ì„œ 00 vs 01ë¡œ êµ¬ë¶„");
    println("");
    
    success_rate = run_corrected_tests();
    
    println("");
    println("ğŸš€ ì„±ëŠ¥ ë¶„ì„:");
    println("=============");
    println("ê³ ì „ ì•Œê³ ë¦¬ì¦˜: ìµœì•… 3ë²ˆ í•¨ìˆ˜ í˜¸ì¶œ");
    println("ì–‘ì ì•Œê³ ë¦¬ì¦˜: 1ë²ˆ í•¨ìˆ˜ í˜¸ì¶œ");
    
    if (success_rate == 100) {
        println("ğŸ‰ ì™„ë²½í•œ Deutsch-Jozsa êµ¬í˜„!");
    } else {
        println("ğŸ”§ ì¶”ê°€ ë””ë²„ê¹… í•„ìš” ({}% ì„±ê³µ)", success_rate);
    }
}