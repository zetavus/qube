// ìˆ˜ì •ëœ Deutsch-Jozsa ì•Œê³ ë¦¬ì¦˜

fn oracle_constant_0() {
    println("    Oracle: f(x) = 0 (ìƒìˆ˜í•¨ìˆ˜)");
    // ì•„ë¬´ê²ƒë„ í•˜ì§€ ì•ŠìŒ
}

fn oracle_constant_1() {
    println("    Oracle: f(x) = 1 (ìƒìˆ˜í•¨ìˆ˜)");
    apply X to q1;
}

fn oracle_balanced_identity() {
    println("    Oracle: f(x) = x (ê· í˜•í•¨ìˆ˜)");
    apply CNOT to (q0, q1);
}

fn oracle_balanced_not() {
    println("    Oracle: f(x) = NOT x (ê· í˜•í•¨ìˆ˜)");
    apply X to q0;
    apply CNOT to (q0, q1);
    apply X to q0;
}

fn deutsch_jozsa_circuit(oracle_name) {
    println("  ğŸ”§ Deutsch-Jozsa íšŒë¡œ ì‹¤í–‰");
    
    circuit DeutschJozsa(2) {
        // 1. ì´ˆê¸°í™”: |01âŸ© ìƒíƒœ
        apply X to q1;
        
        // 2. í•˜ë‹¤ë§ˆë“œ ë³€í™˜
        apply H to ~;
        
        // 3. Oracle ì ìš© (ë™ì ìœ¼ë¡œ ì„ íƒ)
        if (oracle_name == "constant_0") {
            oracle_constant_0();
        }
        if (oracle_name == "constant_1") {
            oracle_constant_1();
        }
        if (oracle_name == "balanced_id") {
            oracle_balanced_identity();
        }
        if (oracle_name == "balanced_not") {
            oracle_balanced_not();
        }
        
        // 4. ë§ˆì§€ë§‰ í•˜ë‹¤ë§ˆë“œ
        apply H to q0;
    }
    
    circuit = DeutschJozsa(2);
    result = measure(circuit, [0]);
    
    return result;
}

fn analyze_deutsch_result(result, expected_type) {
    if (result[0] == 0) {
        println("  ğŸ“Š ê²°ê³¼: ìƒìˆ˜í•¨ìˆ˜");
        if (expected_type == "constant") {
            println("  âœ… ì •í™•í•œ íŒë³„!");
            return true;
        } else {
            println("  âŒ ì˜ëª»ëœ íŒë³„");
            return false;
        }
    } else {
        println("  ğŸ“Š ê²°ê³¼: ê· í˜•í•¨ìˆ˜");
        if (expected_type == "balanced") {
            println("  âœ… ì •í™•í•œ íŒë³„!");
            return true;
        } else {
            println("  âŒ ì˜ëª»ëœ íŒë³„");
            return false;
        }
    }
}

fn test_all_functions() {
    println("ğŸ§ª ì „ì²´ í•¨ìˆ˜ í…ŒìŠ¤íŠ¸");
    println("==================");
    
    success_count = 0;
    total_tests = 4;
    
    // í…ŒìŠ¤íŠ¸ 1: ìƒìˆ˜í•¨ìˆ˜ f(x) = 0
    println("í…ŒìŠ¤íŠ¸ 1: f(x) = 0");
    result1 = deutsch_jozsa_circuit("constant_0");
    if (analyze_deutsch_result(result1, "constant")) {
        success_count = success_count + 1;
    }
    println("");
    
    // í…ŒìŠ¤íŠ¸ 2: ìƒìˆ˜í•¨ìˆ˜ f(x) = 1
    println("í…ŒìŠ¤íŠ¸ 2: f(x) = 1");
    result2 = deutsch_jozsa_circuit("constant_1");
    if (analyze_deutsch_result(result2, "constant")) {
        success_count = success_count + 1;
    }
    println("");
    
    // í…ŒìŠ¤íŠ¸ 3: ê· í˜•í•¨ìˆ˜ f(x) = x
    println("í…ŒìŠ¤íŠ¸ 3: f(x) = x");
    result3 = deutsch_jozsa_circuit("balanced_id");
    if (analyze_deutsch_result(result3, "balanced")) {
        success_count = success_count + 1;
    }
    println("");
    
    // í…ŒìŠ¤íŠ¸ 4: ê· í˜•í•¨ìˆ˜ f(x) = NOT x
    println("í…ŒìŠ¤íŠ¸ 4: f(x) = NOT x");
    result4 = deutsch_jozsa_circuit("balanced_not");
    if (analyze_deutsch_result(result4, "balanced")) {
        success_count = success_count + 1;
    }
    println("");
    
    success_rate = (success_count * 100) / total_tests;
    
    println("ğŸ† ìµœì¢… ê²°ê³¼:");
    println("============");
    println("ì„±ê³µ: {} / {} í…ŒìŠ¤íŠ¸", success_count, total_tests);
    println("ì„±ê³µë¥ : {}%", success_rate);
    
    return success_rate;
}

fn main() {
    println("ğŸŒŸ Deutsch-Jozsa ì•Œê³ ë¦¬ì¦˜");
    println("========================");
    println("ëª©ì : í•¨ìˆ˜ê°€ ìƒìˆ˜ì¸ì§€ ê· í˜•ì¸ì§€ 1ë²ˆ í˜¸ì¶œë¡œ íŒë³„");
    println("");
    
    success_rate = test_all_functions();
    
    println("");
    println("ğŸš€ ì„±ëŠ¥ ë¶„ì„:");
    println("=============");
    println("ê³ ì „ ì•Œê³ ë¦¬ì¦˜: ìµœì•… 3ë²ˆ í•¨ìˆ˜ í˜¸ì¶œ");
    println("ì–‘ì ì•Œê³ ë¦¬ì¦˜: 1ë²ˆ í•¨ìˆ˜ í˜¸ì¶œ");
    
    if (success_rate == 100) {
        println("ğŸ‰ ì™„ë²½í•œ Deutsch-Jozsa êµ¬í˜„!");
    } else {
        println("ğŸ”§ ì¶”ê°€ ë””ë²„ê¹… í•„ìš”");
    }
}