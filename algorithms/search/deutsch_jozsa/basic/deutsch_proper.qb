// ì˜¬ë°”ë¥¸ Deutsch-Jozsa ì•Œê³ ë¦¬ì¦˜ êµ¬í˜„

fn oracle_constant_0() {
    println("    Oracle: f(x) = 0 (ìƒìˆ˜í•¨ìˆ˜)");
    // ì•„ë¬´ê²ƒë„ í•˜ì§€ ì•ŠìŒ - ì¶œë ¥ íë¹—ì„ ë³€ê²½í•˜ì§€ ì•ŠìŒ
}

fn oracle_constant_1() {
    println("    Oracle: f(x) = 1 (ìƒìˆ˜í•¨ìˆ˜)");
    // ì¶œë ¥ íë¹—ì„ í•­ìƒ ë’¤ì§‘ìŒ
    apply X to q1;
}

fn oracle_balanced_identity() {
    println("    Oracle: f(x) = x (ê· í˜•í•¨ìˆ˜)");
    // ì…ë ¥ì´ 1ì´ë©´ ì¶œë ¥ì„ ë’¤ì§‘ìŒ (CNOT)
    apply CNOT to (q0, q1);
}

fn oracle_balanced_not() {
    println("    Oracle: f(x) = NOT x (ê· í˜•í•¨ìˆ˜)");
    // ì…ë ¥ì´ 0ì´ë©´ ì¶œë ¥ì„ ë’¤ì§‘ìŒ
    apply X to q0;      // ì…ë ¥ ë°˜ì „
    apply CNOT to (q0, q1);  // ì¡°ê±´ë¶€ ë’¤ì§‘ê¸°
    apply X to q0;      // ì…ë ¥ ë³µì›
}

fn analyze_input_measurement(result, expected_type, test_name) {
    println("  ì…ë ¥ íë¹— ì¸¡ì •: {}", result);
    
    // ì…ë ¥ íë¹—ì´ ëª¨ë‘ 0ì¸ì§€ í™•ì¸
    if (result[0] == 0) {
        println("  ğŸ“Š ê²°ê³¼: ëª¨ë“  ì…ë ¥ì´ 0 â†’ ìƒìˆ˜í•¨ìˆ˜");
        if (expected_type == 0) {
            println("  âœ… {} ì„±ê³µ!", test_name);
            return true;
        } else {
            println("  âŒ {} ì‹¤íŒ¨", test_name);
            return false;
        }
    } else {
        println("  ğŸ“Š ê²°ê³¼: ì…ë ¥ ì¤‘ 1ì´ ìˆìŒ â†’ ê· í˜•í•¨ìˆ˜");
        if (expected_type == 1) {
            println("  âœ… {} ì„±ê³µ!", test_name);
            return true;
        } else {
            println("  âŒ {} ì‹¤íŒ¨", test_name);
            return false;
        }
    }
}

fn test_constant_0_proper() {
    println("í…ŒìŠ¤íŠ¸ 1: f(x) = 0 (ìƒìˆ˜í•¨ìˆ˜)");
    
    circuit ProperConstant0(2) {
        // 1. ì…ë ¥ íë¹— ì¤‘ì²©ìƒíƒœ (q0)
        apply H to q0;
        // 2. ì¶œë ¥ íë¹—ì„ |1âŸ© ìƒíƒœë¡œ ì´ˆê¸°í™” (q1)
        apply X to q1;
        apply H to q1;
        // 3. Oracle ì ìš©
        oracle_constant_0();
        // 4. ì…ë ¥ íë¹—ì— ë‹¤ì‹œ H ì ìš©
        apply H to q0;
    }
    
    circuit1 = ProperConstant0(2);
    result1 = measure(circuit1, [0]);  // ì…ë ¥ íë¹—ë§Œ ì¸¡ì •!
    
    return analyze_input_measurement(result1, 0, "ìƒìˆ˜í•¨ìˆ˜ f(x)=0");
}

fn test_constant_1_proper() {
    println("í…ŒìŠ¤íŠ¸ 2: f(x) = 1 (ìƒìˆ˜í•¨ìˆ˜)");
    
    circuit ProperConstant1(2) {
        apply H to q0;
        apply X to q1;
        apply H to q1;
        oracle_constant_1();
        apply H to q0;
    }
    
    circuit2 = ProperConstant1(2);
    result2 = measure(circuit2, [0]);
    
    return analyze_input_measurement(result2, 0, "ìƒìˆ˜í•¨ìˆ˜ f(x)=1");
}

fn test_balanced_identity_proper() {
    println("í…ŒìŠ¤íŠ¸ 3: f(x) = x (ê· í˜•í•¨ìˆ˜)");
    
    circuit ProperBalancedId(2) {
        apply H to q0;
        apply X to q1;
        apply H to q1;
        oracle_balanced_identity();
        apply H to q0;
    }
    
    circuit3 = ProperBalancedId(2);
    result3 = measure(circuit3, [0]);
    
    return analyze_input_measurement(result3, 1, "ê· í˜•í•¨ìˆ˜ f(x)=x");
}

fn test_balanced_not_proper() {
    println("í…ŒìŠ¤íŠ¸ 4: f(x) = NOT x (ê· í˜•í•¨ìˆ˜)");
    
    circuit ProperBalancedNot(2) {
        apply H to q0;
        apply X to q1;
        apply H to q1;
        oracle_balanced_not();
        apply H to q0;
    }
    
    circuit4 = ProperBalancedNot(2);
    result4 = measure(circuit4, [0]);
    
    return analyze_input_measurement(result4, 1, "ê· í˜•í•¨ìˆ˜ f(x)=NOT x");
}

fn run_proper_tests() {
    println("ğŸ§ª ì˜¬ë°”ë¥¸ Deutsch-Jozsa êµ¬í˜„ í…ŒìŠ¤íŠ¸");
    println("===================================");
    println("í•µì‹¬: ì¶œë ¥ íë¹— |1âŸ© ì´ˆê¸°í™” + ì…ë ¥ íë¹—ë§Œ ì¸¡ì •");
    println("ì´ë¡ : ìƒìˆ˜í•¨ìˆ˜ â†’ ì…ë ¥ 0, ê· í˜•í•¨ìˆ˜ â†’ ì…ë ¥ 1");
    println("");
    
    success_count = 0;
    
    if (test_constant_0_proper()) {
        success_count = success_count + 1;
    }
    println("");
    
    if (test_constant_1_proper()) {
        success_count = success_count + 1;
    }
    println("");
    
    if (test_balanced_identity_proper()) {
        success_count = success_count + 1;
    }
    println("");
    
    if (test_balanced_not_proper()) {
        success_count = success_count + 1;
    }
    println("");
    
    success_rate = (success_count * 100) / 4;
    
    println("ğŸ† ìµœì¢… ê²°ê³¼:");
    println("============");
    println("ì„±ê³µ: {} / 4 í…ŒìŠ¤íŠ¸", success_count);
    println("ì„±ê³µë¥ : {}%", success_rate);
    
    return success_rate;
}

fn main() {
    println("ğŸŒŸ ì˜¬ë°”ë¥¸ Deutsch-Jozsa ì•Œê³ ë¦¬ì¦˜");
    println("===============================");
    println("ëª©ì : í•¨ìˆ˜ê°€ ìƒìˆ˜ì¸ì§€ ê· í˜•ì¸ì§€ 1ë²ˆ í˜¸ì¶œë¡œ íŒë³„");
    println("í•µì‹¬ ìˆ˜ì •:");
    println("1. ì¶œë ¥ íë¹—ì„ |1âŸ©ë¡œ ì´ˆê¸°í™” (X + H)");
    println("2. ì…ë ¥ íë¹—ë§Œ ì¸¡ì • (ì¶œë ¥ íë¹— ë¬´ì‹œ)");
    println("");
    
    success_rate = run_proper_tests();
    
    println("");
    println("ğŸš€ ì„±ëŠ¥ ë¶„ì„:");
    println("=============");
    println("ê³ ì „ ì•Œê³ ë¦¬ì¦˜: ìµœì•… 3ë²ˆ í•¨ìˆ˜ í˜¸ì¶œ");
    println("ì–‘ì ì•Œê³ ë¦¬ì¦˜: 1ë²ˆ í•¨ìˆ˜ í˜¸ì¶œ");
    
    if (success_rate == 100) {
        println("ğŸ‰ ì™„ë²½í•œ Deutsch-Jozsa êµ¬í˜„ ì„±ê³µ!");
    } else {
        println("ğŸ”§ {}% ì„±ê³µ - ë” ë¶„ì„ í•„ìš”", success_rate);
    }
}