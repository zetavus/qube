// Phase Kickback ì§ì ‘ í…ŒìŠ¤íŠ¸

fn test_basic_phase_kickback() {
    println("ğŸ” Phase Kickback ê¸°ë³¸ í…ŒìŠ¤íŠ¸");
    println("=============================");
    
    println("=== í…ŒìŠ¤íŠ¸ 1: ê¸°ë³¸ ì¤‘ì²© ìƒíƒœ ===");
    circuit BasicSuperposition(2) {
        apply H to q0;
        apply X to q1;
        apply H to q1;
    }
    
    basic = BasicSuperposition(2);
    result1 = measure(basic, [0, 1]);
    println("ê¸°ë³¸ ìƒíƒœ: {}", result1);
    println("ì˜ˆìƒ: ëœë¤í•œ ë¶„í¬");
    println("");
    
    println("=== í…ŒìŠ¤íŠ¸ 2: CNOT ì—†ì´ ===");
    circuit WithoutCNOT(2) {
        apply H to q0;
        apply X to q1;
        apply H to q1;
        apply H to q0;
    }
    
    no_cnot = WithoutCNOT(2);
    result2 = measure(no_cnot, [0]);
    println("CNOT ì—†ì´: {}", result2);
    println("ì˜ˆìƒ: [0] (ì›ë˜ ìƒíƒœë¡œ ë³µê·€)");
    println("");
    
    println("=== í…ŒìŠ¤íŠ¸ 3: CNOT í¬í•¨ ===");
    circuit WithCNOT(2) {
        apply H to q0;
        apply X to q1;
        apply H to q1;
        apply CNOT to (q0, q1);
        apply H to q0;
    }
    
    with_cnot = WithCNOT(2);
    result3 = measure(with_cnot, [0]);
    println("CNOT í¬í•¨: {}", result3);
    println("ì˜ˆìƒ: [1] (Phase Kickback íš¨ê³¼)");
    println("");
}

fn test_explicit_phase() {
    println("ğŸ§ª ëª…ì‹œì  ìœ„ìƒ í…ŒìŠ¤íŠ¸");
    println("===================");
    
    println("=== ì§ì ‘ ìœ„ìƒ ì¡°ì‘ í…ŒìŠ¤íŠ¸ ===");
    circuit PhaseTest(1) {
        apply H to q0;
        apply Z to q0;
        apply H to q0;
    }
    
    phase_test = PhaseTest(1);
    result_phase = measure(phase_test, [0]);
    println("ìœ„ìƒ ì¡°ì‘ ê²°ê³¼: {}", result_phase);
    println("ì˜ˆìƒ: [1] (Z ê²Œì´íŠ¸ íš¨ê³¼)");
    println("");
}

fn compare_oracle_effects() {
    println("âš–ï¸  Oracle íš¨ê³¼ ë¹„êµ");
    println("===================");
    
    println("=== Oracle A: ì•„ë¬´ê²ƒë„ ì•ˆ í•¨ ===");
    circuit OracleA(2) {
        apply H to q0;
        apply X to q1;
        apply H to q1;
        // ì•„ë¬´ê²ƒë„ ì•ˆ í•¨
        apply H to q0;
    }
    
    oracle_a = OracleA(2);
    result_a = measure(oracle_a, [0]);
    println("Oracle A: {}", result_a);
    println("");
    
    println("=== Oracle B: X ê²Œì´íŠ¸ë§Œ ===");
    circuit OracleB(2) {
        apply H to q0;
        apply X to q1;
        apply H to q1;
        apply X to q1;  // ì¶œë ¥ íë¹—ë§Œ ë’¤ì§‘ê¸°
        apply H to q0;
    }
    
    oracle_b = OracleB(2);
    result_b = measure(oracle_b, [0]);
    println("Oracle B: {}", result_b);
    println("");
    
    println("=== Oracle C: CNOT ===");
    circuit OracleC(2) {
        apply H to q0;
        apply X to q1;
        apply H to q1;
        apply CNOT to (q0, q1);  // ì¡°ê±´ë¶€ ë’¤ì§‘ê¸°
        apply H to q0;
    }
    
    oracle_c = OracleC(2);
    result_c = measure(oracle_c, [0]);
    println("Oracle C: {}", result_c);
    println("");
    
    println("ë¶„ì„:");
    println("- Oracle A, B: ìƒìˆ˜í•¨ìˆ˜ (ì…ë ¥ ë¬´ê´€)");
    println("- Oracle C: ê· í˜•í•¨ìˆ˜ (ì…ë ¥ ì˜ì¡´)");
    println("- ì´ë¡ ìƒ A,B â†’ [0], C â†’ [1]ì´ì–´ì•¼ í•¨");
}

fn main() {
    println("ğŸ”¬ Qube Phase Kickback ì§„ë‹¨");
    println("===========================");
    println("ëª©ì : Phase Kickbackì´ ì˜¬ë°”ë¥´ê²Œ ì‘ë™í•˜ëŠ”ì§€ í™•ì¸");
    println("");
    
    test_basic_phase_kickback();
    test_explicit_phase();
    compare_oracle_effects();
    
    println("ğŸ¯ í•µì‹¬ ì§ˆë¬¸:");
    println("=============");
    println("1. CNOTì´ Phase Kickbackì„ ì¼ìœ¼í‚¤ëŠ”ê°€?");
    println("2. Z ê²Œì´íŠ¸ê°€ ì˜¬ë°”ë¥´ê²Œ ìœ„ìƒì„ ë³€ê²½í•˜ëŠ”ê°€?");
    println("3. Deutsch-Jozsaê°€ ì´ë¡ ëŒ€ë¡œ ì‘ë™í•˜ëŠ”ê°€?");
}