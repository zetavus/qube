// algorithms/search/grover_3qubit_test.qb
// 3íë¹— Groverë¡œ ì•Œê³ ë¦¬ì¦˜ ì •í™•ì„± ê²€ì¦
// ëª©í‘œ: |101âŸ© ìƒíƒœ ì°¾ê¸° (8ê°œ ì¤‘ 1ê°œ)

fn create_3qubit_grover() {
    circuit Grover3Qubit(3) {
        println("ğŸ§ª 3íë¹— Grover í…ŒìŠ¤íŠ¸");
        println("======================");
        println("ëª©í‘œ: |101âŸ© ìƒíƒœ ì°¾ê¸°");
        println("ì´ë¡ ì  ìµœì  ë°˜ë³µ: Ï€/4 Ã— âˆš8 â‰ˆ 2.2 â†’ 2íšŒ");
        
        // ì´ˆê¸°í™”: HâŠ—HâŠ—H
        apply H to q0; apply H to q1; apply H to q2;
        println("1ï¸âƒ£ ì´ˆê¸°í™”: 8ê°œ ìƒíƒœ ê· ë“± ë¶„í¬");
        
        // ì²« ë²ˆì§¸ Grover ë°˜ë³µ
        println("2ï¸âƒ£ ì²« ë²ˆì§¸ ë°˜ë³µ:");
        
        // Oracle: |101âŸ© = q2=1, q1=0, q0=1
        apply X to q1;  // q1: 0â†’1 ë³€í™˜
        apply CZ to (q2, q1, q0);  // 3íë¹— CZ
        apply X to q1;  // ë³µì›
        println("2-1) Oracle ì™„ë£Œ");
        
        // Diffusion
        apply H to q0; apply H to q1; apply H to q2;
        apply X to q0; apply X to q1; apply X to q2;
        apply CZ to (q2, q1, q0);
        apply X to q0; apply X to q1; apply X to q2;
        apply H to q0; apply H to q1; apply H to q2;
        println("2-2) Diffusion ì™„ë£Œ");
        
        // ë‘ ë²ˆì§¸ Grover ë°˜ë³µ (ìµœì )
        println("3ï¸âƒ£ ë‘ ë²ˆì§¸ ë°˜ë³µ (ìµœì ):");
        
        apply X to q1;
        apply CZ to (q2, q1, q0);
        apply X to q1;
        
        apply H to q0; apply H to q1; apply H to q2;
        apply X to q0; apply X to q1; apply X to q2;
        apply CZ to (q2, q1, q0);
        apply X to q0; apply X to q1; apply X to q2;
        apply H to q0; apply H to q1; apply H to q2;
        
        println("4ï¸âƒ£ 3íë¹— Grover ì™„ë£Œ");
        println("ì˜ˆìƒ: |101âŸ©ì´ 85% í™•ë¥ ");
    }
    return Grover3Qubit(3);
}

fn test_3qubit_performance() {
    println("");
    println("ğŸ¯ 3íë¹— ì„±ëŠ¥ í…ŒìŠ¤íŠ¸ (10íšŒ):");
    println("============================");
    
    success_count = 0;
    total_trials = 10;
    
    i = 0;
    while (i < total_trials) {
        trial_circuit = create_3qubit_grover();
        trial_result = measure(trial_circuit, [0, 1, 2]);
        trial_value = trial_result[0] + trial_result[1]*2 + trial_result[2]*4;
        
        if (trial_value == 5) {  // |101âŸ© = 5
            success_count = success_count + 1;
            println("ì‹œë„ {}: âœ… ì„±ê³µ |101âŸ©", i+1);
        } else {
            println("ì‹œë„ {}: ğŸ”„ ì‹¤íŒ¨ ({})", i+1, trial_value);
        }
        
        i = i + 1;
    }
    
    println("");
    println("ğŸ“Š 3íë¹— ê²°ê³¼:");
    println("ì„±ê³µ: {} / {}", success_count, total_trials);
    
    if (success_count >= 7) {
        println("âœ… 3íë¹— Grover ì •ìƒ ì‘ë™!");
        println("5íë¹— ë¬¸ì œëŠ” ë‹¤ë¥¸ ì›ì¸");
    } else {
        println("âŒ 3íë¹—ë„ ë¬¸ì œ ìˆìŒ");
        println("Grover êµ¬í˜„ ìì²´ì— ì˜¤ë¥˜");
    }
}

fn main() {
    println("ğŸ§ª 3íë¹— Grover ê²€ì¦ í…ŒìŠ¤íŠ¸");
    println("===========================");
    
    // ë‹¨ì¼ ì‹¤í–‰ í…ŒìŠ¤íŠ¸
    grover_circuit = create_3qubit_grover();
    result = measure(grover_circuit, [0, 1, 2]);
    
    decimal_value = result[0] + result[1]*2 + result[2]*4;
    
    println("");
    println("ğŸ“Š ë‹¨ì¼ ì‹¤í–‰ ê²°ê³¼:");
    println("==================");
    if (decimal_value == 5) {  // |101âŸ©
        println("âœ… ì„±ê³µ! |101âŸ© ìƒíƒœ ë°œê²¬");
    } else {
        println("ğŸ”„ ë‹¤ë¥¸ ìƒíƒœ: {}", decimal_value);
    }
    
    // ì„±ëŠ¥ í…ŒìŠ¤íŠ¸
    test_3qubit_performance();
    
    println("");
    println("ğŸ¯ ë¶„ì„:");
    println("========");
    println("â€¢ 3íë¹—ì´ ì„±ê³µí•˜ë©´: 5íë¹— ë°˜ë³µ íšŸìˆ˜ ë¬¸ì œ");
    println("â€¢ 3íë¹—ë„ ì‹¤íŒ¨í•˜ë©´: Diffusion êµ¬í˜„ ë¬¸ì œ");
    println("â€¢ ë‘ ê²½ìš° ëª¨ë‘: ë²”ìœ„ ë¬¸ë²• êµ¬í˜„ í›„ ì¬ê²€í† ");
    
    println("");
    println("ë‹¤ìŒ: ë²”ìœ„ ë¬¸ë²• (apply CZ to (~, q5)) êµ¬í˜„");
}