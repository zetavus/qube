// algorithms/search/oracle_verification.qb
// Oracle ë‹¨ë… ê²€ì¦: ì •í™•íˆ |10101âŸ©ë§Œ phase flipí•˜ëŠ”ì§€ í™•ì¸

fn test_oracle_on_target() {
    println("ğŸ§ª Oracle ê²€ì¦ 1: íƒ€ê²Ÿ ìƒíƒœì—ì„œ Oracle ì ìš©");
    println("===============================================");
    
    circuit OracleOnTarget(5) {
        // |10101âŸ© ìƒíƒœ ì§ì ‘ ìƒì„±
        apply X to q4;  // q4 = 1
        apply X to q2;  // q2 = 1
        apply X to q0;  // q0 = 1
        // í˜„ì¬: |10101âŸ©
        
        println("ì´ˆê¸° ìƒíƒœ: |10101âŸ©");
        
        // Oracle ì ìš© (phase flipë§Œ ì¼ì–´ë‚˜ê³  ìƒíƒœëŠ” ê·¸ëŒ€ë¡œ)
        apply X to q3; apply X to q1;
        apply CZ to (q4, q3, q2, q1, q0);
        apply X to q1; apply X to q3;
        
        println("Oracle ì ìš© ì™„ë£Œ (phase flipë¨)");
    }
    
    target_circuit = OracleOnTarget(5);
    result = measure(target_circuit, [0, 1, 2, 3, 4]);
    value = result[0] + result[1]*2 + result[2]*4 + result[3]*8 + result[4]*16;
    
    if (value == 21) {
        println("âœ… í†µê³¼: |10101âŸ© ìƒíƒœ ìœ ì§€ë¨");
    } else {
        println("âŒ ì‹¤íŒ¨: ìƒíƒœê°€ {}ë¡œ ë³€ê²½ë¨", value);
    }
}

fn test_oracle_on_non_target() {
    println("");
    println("ğŸ§ª Oracle ê²€ì¦ 2: ë¹„íƒ€ê²Ÿ ìƒíƒœì—ì„œ Oracle ì ìš©");
    println("==============================================");
    
    circuit OracleOnNonTarget(5) {
        // |00000âŸ© ìƒíƒœì—ì„œ Oracle ì ìš©
        // phase flipì´ ì¼ì–´ë‚˜ì§€ ì•Šì•„ì•¼ í•¨
        
        println("ì´ˆê¸° ìƒíƒœ: |00000âŸ©");
        
        apply X to q3; apply X to q1;
        apply CZ to (q4, q3, q2, q1, q0);
        apply X to q1; apply X to q3;
        
        println("Oracle ì ìš© ì™„ë£Œ (phase flip ì•ˆë¨)");
    }
    
    non_target_circuit = OracleOnNonTarget(5);
    result = measure(non_target_circuit, [0, 1, 2, 3, 4]);
    value = result[0] + result[1]*2 + result[2]*4 + result[3]*8 + result[4]*16;
    
    if (value == 0) {
        println("âœ… í†µê³¼: |00000âŸ© ìƒíƒœ ìœ ì§€ë¨");
    } else {
        println("âŒ ì‹¤íŒ¨: ìƒíƒœê°€ {}ë¡œ ë³€ê²½ë¨", value);
    }
}

fn test_cz_gate_simple() {
    println("");
    println("ğŸ§ª CZ ê²Œì´íŠ¸ ê²€ì¦: 2íë¹— ê¸°ë³¸ í…ŒìŠ¤íŠ¸");
    println("===================================");
    
    circuit SimpleCZ(2) {
        apply X to q0;  // |01âŸ© ìƒíƒœ
        apply CZ to (q1, q0);  // q1=0, q0=1ì´ë¯€ë¡œ phase flip ì•ˆë¨
    }
    
    simple_circuit = SimpleCZ(2);
    result = measure(simple_circuit, [0, 1]);
    value = result[0] + result[1]*2;
    
    if (value == 1) {  // |01âŸ©
        println("âœ… 2íë¹— CZ ì •ìƒ");
    } else {
        println("âŒ 2íë¹— CZ ì˜¤ë¥˜: {}", value);
    }
}

fn test_5qubit_cz() {
    println("");
    println("ğŸ§ª 5íë¹— CZ ê²Œì´íŠ¸ ê²€ì¦");
    println("=======================");
    
    circuit FiveQubitCZ(5) {
        // |11111âŸ© ìƒíƒœ ìƒì„±
        apply X to q0; apply X to q1; apply X to q2; apply X to q3; apply X to q4;
        
        println("ì´ˆê¸° ìƒíƒœ: |11111âŸ©");
        
        // 5íë¹— CZ ì ìš© (phase flip ë°œìƒ)
        apply CZ to (q4, q3, q2, q1, q0);
        
        println("5íë¹— CZ ì ìš© ì™„ë£Œ");
    }
    
    five_qubit_circuit = FiveQubitCZ(5);
    result = measure(five_qubit_circuit, [0, 1, 2, 3, 4]);
    value = result[0] + result[1]*2 + result[2]*4 + result[3]*8 + result[4]*16;
    
    if (value == 31) {  // |11111âŸ© = 31
        println("âœ… 5íë¹— CZ ì •ìƒ: ìƒíƒœ ìœ ì§€ë¨");
    } else {
        println("âŒ 5íë¹— CZ ì˜¤ë¥˜: {}", value);
    }
}

fn main() {
    println("ğŸ”¬ Oracleê³¼ CZ ê²Œì´íŠ¸ ì •í™•ì„± ê²€ì¦");
    println("=================================");
    
    // ë‹¨ê³„ë³„ ê²€ì¦
    test_cz_gate_simple();     // 2íë¹— CZ ê¸°ë³¸ í…ŒìŠ¤íŠ¸
    test_5qubit_cz();          // 5íë¹— CZ í…ŒìŠ¤íŠ¸
    test_oracle_on_target();   // Oracle on |10101âŸ©
    test_oracle_on_non_target(); // Oracle on |00000âŸ©
    
    println("");
    println("ğŸ¯ ê²°ë¡ :");
    println("=======");
    println("ëª¨ë“  í…ŒìŠ¤íŠ¸ê°€ í†µê³¼í•˜ë©´ Oracleì€ ì •í™•í•¨");
    println("ì‹¤íŒ¨í•˜ëŠ” í…ŒìŠ¤íŠ¸ê°€ ìˆë‹¤ë©´ í•´ë‹¹ ë¶€ë¶„ ìˆ˜ì • í•„ìš”");
    
    println("");
    println("ë‹¤ìŒ ë‹¨ê³„: ìˆ˜ì •ëœ Grover ì•Œê³ ë¦¬ì¦˜ ì‹¤í–‰");
}