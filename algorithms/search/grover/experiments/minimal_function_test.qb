// algorithms/search/manual_loop_test.qb
// ìˆ˜ë™ ë°˜ë³µìœ¼ë¡œ for ë¬¸ë²• ìš°íšŒ

fn apply_oracle() {
    println("ğŸ¯ Oracle í•¨ìˆ˜ ì‹¤í–‰");
    apply X to q1;
    apply X to q3;
    apply CZ to (q0, q1, q2, q3, q4);
    apply X to q1;
    apply X to q3;
}

fn apply_diffusion() {
    println("ğŸ”„ Diffusion í•¨ìˆ˜ ì‹¤í–‰");
    apply H to ~;
    apply X to ~;
    apply CZ to (q0, q1, q2, q3, q4);
    apply X to ~;
    apply H to ~;
}

fn main() {
    println("ğŸ§ª ìˆ˜ë™ ë°˜ë³µ í…ŒìŠ¤íŠ¸");
    println("==================");
    
    circuit ManualLoopTest(5) {
        println("íšŒë¡œ ì‹œì‘");
        
        // ì´ˆê¸°í™”
        apply H to ~;
        
        // ìˆ˜ë™ìœ¼ë¡œ 4íšŒ ë°˜ë³µ (for ë¬¸ë²• ìš°íšŒ)
        println("=== ë°˜ë³µ 1 ===");
        apply_oracle();
        apply_diffusion();
        
        println("=== ë°˜ë³µ 2 ===");
        apply_oracle();
        apply_diffusion();
        
        println("=== ë°˜ë³µ 3 ===");
        apply_oracle();
        apply_diffusion();
        
        println("=== ë°˜ë³µ 4 ===");
        apply_oracle();
        apply_diffusion();
        
        println("íšŒë¡œ ì™„ë£Œ");
    }
    
    println("íšŒë¡œ ìƒì„± ì¤‘...");
    circuit = ManualLoopTest();
    
    println("ì¸¡ì • ì¤‘...");
    result = measure(circuit, [0, 1, 2, 3, 4]);
    
    decimal = result[0] + result[1]*2 + result[2]*4 + result[3]*8 + result[4]*16;
    
    println("ê²°ê³¼: {}", result);
    println("ì‹­ì§„ìˆ˜: {}", decimal);
    
    if (decimal == 21) {
        println("âœ… ì„±ê³µ! |10101âŸ© ë°œê²¬!");
        println("ğŸ‰ íšŒë¡œ ë‚´ë¶€ í•¨ìˆ˜ í˜¸ì¶œ ì„±ê³µ!");
    } else {
        println("ë‹¤ë¥¸ ìƒíƒœ: {}", decimal);
    }
}