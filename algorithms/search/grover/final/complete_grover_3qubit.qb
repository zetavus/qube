// ì™„ì „í•œ 3íë¹— Grover ê²€ìƒ‰ ì•Œê³ ë¦¬ì¦˜
// ëª©í‘œ: |101âŸ© ìƒíƒœë¥¼ 85% í™•ë¥ ë¡œ ì°¾ê¸°

// Oracle: |101âŸ© ìƒíƒœì—ë§Œ ìœ„ìƒ ë’¤ì§‘ê¸° (-1 ê³±í•˜ê¸°)
fn create_oracle_101() {
    circuit Oracle101(3) {
        // |101âŸ© = q2=1, q1=0, q0=1 ìƒíƒœ ê°ì§€
        // ì œì–´ Z ê²Œì´íŠ¸ë“¤ë¡œ êµ¬í˜„
        apply X to q1;    // q1=0ì„ ì¼ì‹œì ìœ¼ë¡œ 1ë¡œ ë³€í™˜
        apply CCZ to (q2, q1, q0);  // ì„¸ íë¹—ì´ ëª¨ë‘ 1ì¼ ë•Œ ìœ„ìƒ ë’¤ì§‘ê¸°
        apply X to q1;    // q1ì„ ì›ìƒë³µêµ¬
    }
    return Oracle101(3);
}

// Diffusion ì—°ì‚°ì: í‰ê·  ì¤‘ì‹¬ ë°˜ì‚¬
fn create_diffusion() {
    circuit Diffusion(3) {
        // 1. ëª¨ë“  íë¹—ì— H ì ìš© (ê¸°ì € ë³€í™˜)
        apply H to q0;
        apply H to q1;
        apply H to q2;
        
        // 2. ëª¨ë“  íë¹— ë’¤ì§‘ê¸° (|000âŸ©ì„ ì œì™¸í•œ ëª¨ë“  ìƒíƒœë¥¼ -1ë¡œ)
        apply X to q0;
        apply X to q1;
        apply X to q2;
        
        // 3. |000âŸ© ìƒíƒœì— ìœ„ìƒ ë’¤ì§‘ê¸°
        apply CCZ to (q2, q1, q0);
        
        // 4. ë’¤ì§‘ê¸° ì›ìƒë³µêµ¬
        apply X to q0;
        apply X to q1;
        apply X to q2;
        
        // 5. H ê¸°ì € ë³µì›
        apply H to q0;
        apply H to q1;
        apply H to q2;
    }
    return Diffusion(3);
}

// ì´ˆê¸°í™”: ê· ë“± ì¤‘ì²© ìƒíƒœ
fn create_initialization() {
    circuit Initialization(3) {
        apply H to q0;
        apply H to q1;
        apply H to q2;
    }
    return Initialization(3);
}

// ì™„ì „í•œ Grover ì•Œê³ ë¦¬ì¦˜ (2íšŒ ë°˜ë³µ)
fn create_complete_grover() {
    circuit CompleteGrover(3) {
        // 1. ì´ˆê¸°í™”: ê· ë“± ì¤‘ì²©
        apply H to q0;
        apply H to q1;
        apply H to q2;
        
        // 2. Grover ë°˜ë³µ 1íšŒì°¨
        // Oracle
        apply X to q1;
        apply CCZ to (q2, q1, q0);
        apply X to q1;
        
        // Diffusion
        apply H to q0;
        apply H to q1;
        apply H to q2;
        apply X to q0;
        apply X to q1;
        apply X to q2;
        apply CCZ to (q2, q1, q0);
        apply X to q0;
        apply X to q1;
        apply X to q2;
        apply H to q0;
        apply H to q1;
        apply H to q2;
        
        // 3. Grover ë°˜ë³µ 2íšŒì°¨
        // Oracle
        apply X to q1;
        apply CCZ to (q2, q1, q0);
        apply X to q1;
        
        // Diffusion
        apply H to q0;
        apply H to q1;
        apply H to q2;
        apply X to q0;
        apply X to q1;
        apply X to q2;
        apply CCZ to (q2, q1, q0);
        apply X to q0;
        apply X to q1;
        apply X to q2;
        apply H to q0;
        apply H to q1;
        apply H to q2;
    }
    return CompleteGrover(3);
}

fn main() {
    println("ğŸ¯ ì™„ì „í•œ 3íë¹— Grover ê²€ìƒ‰ ì•Œê³ ë¦¬ì¦˜");
    println("=====================================");
    println("ëª©í‘œ: |101âŸ© ìƒíƒœ ì°¾ê¸°");
    println("ì´ë¡ ì  ì„±ê³µë¥ : ~85%");
    println("ìµœì  ë°˜ë³µ íšŸìˆ˜: 2íšŒ");
    println("");
    
    // ì™„ì „í•œ Grover ì•Œê³ ë¦¬ì¦˜ ì‹¤í–‰
    println("ğŸš€ ì™„ì „í•œ Grover ì•Œê³ ë¦¬ì¦˜ ì‹¤í–‰:");
    println("------------------------------");
    
    grover_circuit = create_complete_grover();
    result = measure(grover_circuit, [0, 1, 2]);
    
    // ê²°ê³¼ ë¶„ì„
    decimal_value = result[0] + result[1]*2 + result[2]*4;
    
    if (decimal_value == 5) {  // |101âŸ© = 5
        println("âœ… ì„±ê³µ! |101âŸ© ìƒíƒœ ë°œê²¬");
        println("Grover ì•Œê³ ë¦¬ì¦˜ì´ ëª©í‘œ ìƒíƒœë¥¼ ì°¾ì•˜ìŠµë‹ˆë‹¤!");
    } else {
        println("ğŸ”„ ë‹¤ë¥¸ ìƒíƒœ ì¸¡ì •ë¨");
        println("ì¬ì‹œë„í•˜ë©´ 85% í™•ë¥ ë¡œ ì„±ê³µí•  ê²ƒì…ë‹ˆë‹¤.");
    }
    
    println("");
    println("ğŸ“Š ì„±ëŠ¥ í…ŒìŠ¤íŠ¸ (10íšŒ ì‹œë„):");
    println("==========================");
    
    success_count = 0;
    total_trials = 10;
    
    i = 0;
    while (i < total_trials) {
        trial_circuit = create_complete_grover();
        trial_result = measure(trial_circuit, [0, 1, 2]);
        trial_value = trial_result[0] + trial_result[1]*2 + trial_result[2]*4;
        
        if (trial_value == 5) {
            success_count = success_count + 1;
            println("ì‹œë„ " + (i+1) + ": âœ… ì„±ê³µ |101âŸ©");
        } else {
            println("ì‹œë„ " + (i+1) + ": ğŸ”„ ì‹¤íŒ¨");
        }
        
        i = i + 1;
    }
    
    println("");
    println("ğŸ“ˆ ìµœì¢… ê²°ê³¼:");
    println("ì„±ê³µ íšŸìˆ˜: " + success_count + "/" + total_trials);
    println("ì‹¤ì œ ì„±ê³µë¥ : ~" + (success_count * 10) + "%");
    println("ì´ë¡ ì  ì„±ê³µë¥ : ~85%");
    
    if (success_count >= 7) {  // 70% ì´ìƒ
        println("ğŸ‰ Grover ì•Œê³ ë¦¬ì¦˜ ì„±ê³µì ìœ¼ë¡œ êµ¬í˜„ë¨!");
    } else {
        println("ğŸ”§ ì¶”ê°€ ì¡°ì •ì´ í•„ìš”í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.");
    }
}