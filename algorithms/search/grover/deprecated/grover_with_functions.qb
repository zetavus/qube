// algorithms/search/grover_with_functions.qb
// íšŒë¡œ ë‚´ë¶€ í•¨ìˆ˜ í˜¸ì¶œ ë° ë°˜ë³µë¬¸ í…ŒìŠ¤íŠ¸

fn oracle_10101() {
    println("    ğŸ¯ Oracle í•¨ìˆ˜ ì‹¤í–‰ì¤‘");
    apply X to q1;
    apply X to q3;
    apply CZ to (q0, q1, q2, q3, q4);
    apply X to q1;
    apply X to q3;
    println("    âœ… Oracle ì™„ë£Œ");
}

fn diffusion() {
    println("    ğŸ”„ Diffusion í•¨ìˆ˜ ì‹¤í–‰ì¤‘");
    apply H to ~;
    apply X to ~;
    apply CZ to (q0, q1, q2, q3, q4);
    apply X to ~;
    apply H to ~;
    println("    âœ… Diffusion ì™„ë£Œ");
}

fn grover_iteration(iter_num) {
    println("  --- Grover ë°˜ë³µ {} ---", iter_num);
    oracle_10101();
    diffusion();
}

fn main() {
    println("ğŸŒŸ íšŒë¡œ ë‚´ë¶€ í•¨ìˆ˜ í˜¸ì¶œ ë° ë°˜ë³µë¬¸ í…ŒìŠ¤íŠ¸");
    println("=====================================");
    println("");
    
    circuit GroverWithFunctions(5) {
        println("ğŸš€ íšŒë¡œ ì‹œì‘");
        
        // ì´ˆê¸°í™”
        println("ğŸ“¦ ì´ˆê¸°í™”: ê· ë“± ì¤‘ì²© ìƒíƒœ");
        apply H to ~;
        
        // ğŸ”‘ í•µì‹¬ í…ŒìŠ¤íŠ¸ 1: íšŒë¡œ ë‚´ë¶€ì—ì„œ for ë°˜ë³µë¬¸
        println("ğŸ”„ for ë°˜ë³µë¬¸ í…ŒìŠ¤íŠ¸ ì‹œì‘");
        for iteration in 0..4 {
            println("ë°˜ë³µ ë²ˆí˜¸: {}", iteration);
            
            // ğŸ”‘ í•µì‹¬ í…ŒìŠ¤íŠ¸ 2: íšŒë¡œ ë‚´ë¶€ì—ì„œ í•¨ìˆ˜ í˜¸ì¶œ
            grover_iteration(iteration);
        }
        
        println("âœ… íšŒë¡œ ì™„ë£Œ");
    }
    
    println("íšŒë¡œ ìƒì„± ì¤‘...");
    grover = GroverWithFunctions();
    
    println("ì¸¡ì • ì¤‘...");
    result = measure(grover, [0, 1, 2, 3, 4]);
    
    decimal = result[0] + result[1]*2 + result[2]*4 + result[3]*8 + result[4]*16;
    
    println("");
    println("ğŸ† ìµœì¢… ê²°ê³¼:");
    println("============");
    println("ì¸¡ì •ê°’: {}", result);
    println("ì‹­ì§„ìˆ˜: {}", decimal);
    
    if (decimal == 21) {
        println("âœ… ì„±ê³µ! |10101âŸ© ë°œê²¬!");
        println("ğŸ‰ íšŒë¡œ ë‚´ë¶€ í•¨ìˆ˜ í˜¸ì¶œ ë° ë°˜ë³µë¬¸ ì„±ê³µ!");
    } else {
        println("âŒ ë‹¤ë¥¸ ìƒíƒœ: {}", decimal);
    }
    
    println("");
    println("ğŸ¯ í…ŒìŠ¤íŠ¸ ì™„ë£Œ:");
    println("==============");
    println("âœ… íšŒë¡œ ë‚´ë¶€ for ë°˜ë³µë¬¸");
    println("âœ… íšŒë¡œ ë‚´ë¶€ í•¨ìˆ˜ í˜¸ì¶œ");
    println("âœ… ì¤‘ì²©ëœ í•¨ìˆ˜ í˜¸ì¶œ");
    println("âœ… ë°˜ë³µë¬¸ + í•¨ìˆ˜ ì¡°í•©");
}