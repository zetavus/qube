// algorithms/search/grover_fixed.qb
// ìˆ˜ì •ëœ 5íë¹— Grover ì•Œê³ ë¦¬ì¦˜
// Oracle ì •í™•ì„± ìˆ˜ì •: |10101âŸ©ë§Œ ì •í™•íˆ phase flip

fn create_correct_oracle_grover() {
    circuit FixedGrover5Qubit(5) {
        println("ğŸ”§ ìˆ˜ì •ëœ Oracleë¡œ Grover ì•Œê³ ë¦¬ì¦˜");
        println("===================================");
        
        // 1. ì´ˆê¸°í™”: ê· ë“± ì¤‘ì²©
        apply H to q0; apply H to q1; apply H to q2; apply H to q3; apply H to q4;
        println("1ï¸âƒ£ ì´ˆê¸°í™” ì™„ë£Œ: 32ê°œ ìƒíƒœ ê· ë“± ë¶„í¬");
        
        // ìˆ˜ì •ëœ Oracle í…ŒìŠ¤íŠ¸
        println("2ï¸âƒ£ ìˆ˜ì •ëœ Oracle ì ìš©:");
        println("ëª©í‘œ: |10101âŸ© = q4=1, q3=0, q2=1, q1=0, q0=1");
        
        // Oracle ë°©ë²• 1: ì§ì ‘ ì œì–´ (ë” ì •í™•)
        // |10101âŸ©ì—ì„œë§Œ phase flipí•˜ë ¤ë©´:
        // q4=1, q2=1, q0=1 ì œì–´í•˜ê³ , q3=0, q1=0ëŠ” Xë¡œ ë’¤ì§‘ì–´ì„œ ì œì–´
        
        apply X to q3;  // q3: 0â†’1 ë³€í™˜
        apply X to q1;  // q1: 0â†’1 ë³€í™˜
        
        // ì´ì œ |10101âŸ© ìƒíƒœëŠ” |11111âŸ©ë¡œ ë³€í™˜ë¨
        // 5íë¹— ëª¨ë‘ 1ì¸ ìƒíƒœì— CZ ì ìš©
        apply CZ to (q4, q3, q2, q1, q0);
        
        apply X to q1;  // q1 ë³µì›
        apply X to q3;  // q3 ë³µì›
        println("2-1) Oracle 1íšŒì°¨ ì™„ë£Œ");
        
        // Diffusion ì—°ì‚°ì
        println("2-2) Diffusion ì—°ì‚°ì ì ìš©");
        apply H to q0; apply H to q1; apply H to q2; apply H to q3; apply H to q4;
        apply X to q0; apply X to q1; apply X to q2; apply X to q3; apply X to q4;
        apply CZ to (q4, q3, q2, q1, q0);
        apply X to q0; apply X to q1; apply X to q2; apply X to q3; apply X to q4;
        apply H to q0; apply H to q1; apply H to q2; apply H to q3; apply H to q4;
        println("2-3) ì²« ë²ˆì§¸ Grover ë°˜ë³µ ì™„ë£Œ");
        
        // 2íšŒì°¨
        println("3ï¸âƒ£ 2íšŒì°¨ Grover ë°˜ë³µ:");
        apply X to q3; apply X to q1;
        apply CZ to (q4, q3, q2, q1, q0);
        apply X to q1; apply X to q3;
        
        apply H to q0; apply H to q1; apply H to q2; apply H to q3; apply H to q4;
        apply X to q0; apply X to q1; apply X to q2; apply X to q3; apply X to q4;
        apply CZ to (q4, q3, q2, q1, q0);
        apply X to q0; apply X to q1; apply X to q2; apply X to q3; apply X to q4;
        apply H to q0; apply H to q1; apply H to q2; apply H to q3; apply H to q4;
        
        // 3íšŒì°¨
        println("4ï¸âƒ£ 3íšŒì°¨ Grover ë°˜ë³µ:");
        apply X to q3; apply X to q1;
        apply CZ to (q4, q3, q2, q1, q0);
        apply X to q1; apply X to q3;
        
        apply H to q0; apply H to q1; apply H to q2; apply H to q3; apply H to q4;
        apply X to q0; apply X to q1; apply X to q2; apply X to q3; apply X to q4;
        apply CZ to (q4, q3, q2, q1, q0);
        apply X to q0; apply X to q1; apply X to q2; apply X to q3; apply X to q4;
        apply H to q0; apply H to q1; apply H to q2; apply H to q3; apply H to q4;
        
        // 4íšŒì°¨ (ìµœì  ë°˜ë³µ)
        println("5ï¸âƒ£ 4íšŒì°¨ Grover ë°˜ë³µ (ìµœì ):");
        apply X to q3; apply X to q1;
        apply CZ to (q4, q3, q2, q1, q0);
        apply X to q1; apply X to q3;
        
        apply H to q0; apply H to q1; apply H to q2; apply H to q3; apply H to q4;
        apply X to q0; apply X to q1; apply X to q2; apply X to q3; apply X to q4;
        apply CZ to (q4, q3, q2, q1, q0);
        apply X to q0; apply X to q1; apply X to q2; apply X to q3; apply X to q4;
        apply H to q0; apply H to q1; apply H to q2; apply H to q3; apply H to q4;
        
        println("6ï¸âƒ£ 4íšŒ Grover ë°˜ë³µ ì™„ë£Œ");
        println("ì˜ˆìƒ: |10101âŸ© í™•ë¥ ì´ 85%ì— ê·¼ì ‘í•´ì•¼ í•¨");
    }
    return FixedGrover5Qubit(5);
}

fn test_oracle_isolation() {
    println("");
    println("ğŸ§ª Oracle ë‹¨ë… ê²€ì¦:");
    println("====================");
    
    circuit OracleOnly(5) {
        // íŠ¹ì • ìƒíƒœë¡œ ì´ˆê¸°í™”í•´ì„œ Oracle í…ŒìŠ¤íŠ¸
        // |10101âŸ© ìƒíƒœë¥¼ ë§Œë“¤ì–´ì„œ Oracleì´ ì •í™•íˆ ì‘ë™í•˜ëŠ”ì§€ í™•ì¸
        
        apply X to q4;  // q4 = 1
        apply X to q2;  // q2 = 1  
        apply X to q0;  // q0 = 1
        // í˜„ì¬ ìƒíƒœ: |10101âŸ©
        
        println("ì´ˆê¸° ìƒíƒœ: |10101âŸ© ì¤€ë¹„ ì™„ë£Œ");
        
        // Oracle ì ìš©
        apply X to q3;  // q3: 0â†’1
        apply X to q1;  // q1: 0â†’1
        apply CZ to (q4, q3, q2, q1, q0);  // phase flip
        apply X to q1;  // ë³µì›
        apply X to q3;  // ë³µì›
        
        println("Oracle ì ìš© ì™„ë£Œ");
        println("ê²°ê³¼: |10101âŸ© ìƒíƒœì— phaseê°€ -1 ê³±í•´ì§ (ì¸¡ì •ìœ¼ë¡œëŠ” ë³´ì´ì§€ ì•ŠìŒ)");
    }
    
    oracle_test = OracleOnly(5);
    oracle_result = measure(oracle_test, [0, 1, 2, 3, 4]);
    oracle_value = oracle_result[0] + oracle_result[1]*2 + oracle_result[2]*4 + oracle_result[3]*8 + oracle_result[4]*16;
    
    if (oracle_value == 21) {
        println("âœ… Oracle í…ŒìŠ¤íŠ¸: |10101âŸ© ìƒíƒœ ìœ ì§€ë¨ (ì •ìƒ)");
    } else {
        println("âŒ Oracle í…ŒìŠ¤íŠ¸: ìƒíƒœê°€ ë³€ê²½ë¨ (ì˜¤ë¥˜!)");
    }
}

fn main() {
    println("ğŸš€ ìˆ˜ì •ëœ 5íë¹— Grover ì•Œê³ ë¦¬ì¦˜");
    println("================================");
    
    // Oracle ë‹¨ë… í…ŒìŠ¤íŠ¸
    test_oracle_isolation();
    
    println("");
    println("ğŸ”§ ì „ì²´ Grover ì•Œê³ ë¦¬ì¦˜ ì‹¤í–‰:");
    
    // ìˆ˜ì •ëœ Grover ì‹¤í–‰
    grover_circuit = create_correct_oracle_grover();
    result = measure(grover_circuit, [0, 1, 2, 3, 4]);
    
    decimal_value = result[0] + result[1]*2 + result[2]*4 + result[3]*8 + result[4]*16;
    
    println("");
    println("ğŸ“Š ìµœì¢… ì¸¡ì • ê²°ê³¼:");
    println("==================");
    if (decimal_value == 21) {  // |10101âŸ©
        println("âœ… ì„±ê³µ! |10101âŸ© ìƒíƒœ ë°œê²¬");
        println("ğŸ‰ Oracle ìˆ˜ì • í›„ ì •ìƒ ì‘ë™!");
    } else {
        println("ğŸ”„ ë‹¤ë¥¸ ìƒíƒœ ì¸¡ì •ë¨: {}", decimal_value);
        println("ìƒíƒœ ë¶„í¬ë¥¼ í™•ì¸í•´ë³´ì„¸ìš”");
    }
    
    println("");
    println("ğŸ¯ ë‹¤ìŒ ë‹¨ê³„:");
    println("=============");
    println("1. ì„±ëŠ¥ í…ŒìŠ¤íŠ¸ (100íšŒ ì‹œë„)");
    println("2. ë‹¤ë¥¸ íƒ€ê²Ÿ ìƒíƒœë¡œ Oracle ì¼ë°˜í™”");
    println("3. ë²”ìœ„ ë¬¸ë²• êµ¬í˜„ (apply CZ to (~, q5))");
    
    println("");
    println("ğŸ’¡ ì´ë¡ ì  ë°°ê²½:");
    println("================");
    println("â€¢ 5íë¹— ìµœì  ë°˜ë³µ: Ï€/4 Ã— âˆš32 â‰ˆ 4.4íšŒ");
    println("â€¢ 4íšŒ ë°˜ë³µ ì‹œ ì„±ê³µë¥ : ~85%");
    println("â€¢ 5íšŒ ë°˜ë³µ ì‹œ ì„±ê³µë¥ : ~70% (overshoot)");
    println("â€¢ í˜„ì¬ êµ¬í˜„: 4íšŒ ë°˜ë³µ = ìµœì !");
}