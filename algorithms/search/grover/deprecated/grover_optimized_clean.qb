// algorithms/search/grover_optimized_clean.qb
// ê°œì„ ëœ 5íë¹— Grover ì•Œê³ ë¦¬ì¦˜ (êµ¬ì¡° ë¶„ë¦¬ + ë°˜ë³µë¬¸)

fn grover_oracle_10101(circuit) {
    // Oracle: |10101âŸ© ìƒíƒœë¥¼ ë§ˆí‚¹
    // |10101âŸ© = q4=1, q3=0, q2=1, q1=0, q0=1
    // 0ì¸ íë¹—ì— Xë¥¼ ì ìš©í•˜ì—¬ |11111âŸ©ë¡œ ë³€í™˜ í›„ ì œì–´
    
    println("  ğŸ¯ Oracle: |10101âŸ© ë§ˆí‚¹");
    
    // q3, q1ì„ ë’¤ì§‘ì–´ì„œ |11111âŸ© ë§Œë“¤ê¸°
    apply X to q1;  // q1: 0â†’1
    apply X to q3;  // q3: 0â†’1
    
    // ëª¨ë“  íë¹—ì´ |1âŸ©ì¼ ë•Œ ìœ„ìƒ ë’¤ì§‘ê¸°
    apply CZ to (q0, q1, q2, q3, q4);
    
    // ì›ìƒë³µêµ¬
    apply X to q1;  // q1: 1â†’0
    apply X to q3;  // q3: 1â†’0
}

fn grover_diffusion(circuit) {
    // Diffusion Operator (Amplitude Amplification)
    // í‰ê· ì„ ì¤‘ì‹¬ìœ¼ë¡œ ì§„í­ ë°˜ì „
    
    println("  ğŸ”„ Diffusion: ì§„í­ ì¦í­");
    
    // |+âŸ© ìƒíƒœë¥¼ |0âŸ©ë¡œ ë³€í™˜
    apply H to ~;   // ëª¨ë“  íë¹—ì— H
    
    // |00000âŸ©ì„ ì œì™¸í•œ ëª¨ë“  ìƒíƒœì— -1 ìœ„ìƒ
    apply X to ~;   // ëª¨ë“  íë¹— ë’¤ì§‘ê¸° (|00000âŸ© â†’ |11111âŸ©)
    apply CZ to (q0, q1, q2, q3, q4);  // |11111âŸ©ì— -1 ìœ„ìƒ
    apply X to ~;   // ì›ìƒë³µêµ¬
    
    // |0âŸ© ìƒíƒœë¥¼ |+âŸ©ë¡œ ë³€í™˜
    apply H to ~;   // ëª¨ë“  íë¹—ì— H
}

fn create_grover_5qubit() {
    circuit Grover5Qubit(5) {
        println("ğŸš€ 5íë¹— Grover ì•Œê³ ë¦¬ì¦˜ ì‹œì‘");
        
        // 1ë‹¨ê³„: ì´ˆê¸°í™” (ê· ë“± ì¤‘ì²© ìƒíƒœ)
        println("1ï¸âƒ£ ì´ˆê¸°í™”: ê· ë“± ì¤‘ì²© ìƒíƒœ ìƒì„±");
        apply H to ~;  // |00000âŸ© â†’ (1/âˆš32) Î£|xâŸ©
        
        // 2ë‹¨ê³„: Grover ë°˜ë³µ 4íšŒ
        println("2ï¸âƒ£ Grover ë°˜ë³µ (Oracle + Diffusion) Ã— 4íšŒ");
        
        // ìµœì  ë°˜ë³µ íšŸìˆ˜: Ï€/4 * âˆšN â‰ˆ Ï€/4 * âˆš32 â‰ˆ 4.44 â†’ 4íšŒ
        for iteration in 0..4 {
            println("  --- ë°˜ë³µ {} ---", iteration + 1);
            
            // Oracle: ëª©í‘œ ìƒíƒœ ë§ˆí‚¹
            grover_oracle_10101(this);
            
            // Diffusion: ì§„í­ ì¦í­
            grover_diffusion(this);
        }
        
        println("3ï¸âƒ£ Grover ì•Œê³ ë¦¬ì¦˜ ì™„ë£Œ");
    }
    
    return Grover5Qubit(5);
}

fn verify_target_state(result) {
    // |10101âŸ© í™•ì¸
    // result = [q0, q1, q2, q3, q4]
    expected = [1, 0, 1, 0, 1];  // |10101âŸ©
    
    is_correct = true;
    for i in 0..5 {
        if (result[i] != expected[i]) {
            is_correct = false;
            break;
        }
    }
    
    // ì‹­ì§„ìˆ˜ ë³€í™˜ (ê²€ì¦ìš©)
    decimal_value = 0;
    for i in 0..5 {
        decimal_value = decimal_value + result[i] * (2^i);
    }
    
    return {
        "is_correct": is_correct,
        "decimal": decimal_value,
        "binary_string": format("|{}{}{}{}{}âŸ©", result[4], result[3], result[2], result[1], result[0])
    };
}

fn run_performance_test() {
    println("ğŸ¯ Grover ì•Œê³ ë¦¬ì¦˜ ì„±ëŠ¥ í…ŒìŠ¤íŠ¸");
    println("==============================");
    println("ëª©í‘œ: |10101âŸ© ìƒíƒœ ì°¾ê¸° (ì‹­ì§„ìˆ˜: 21)");
    println("ì‹œë„ íšŸìˆ˜: 20íšŒ");
    println("ì´ë¡ ì  ì„±ê³µë¥ : ~99.9%");
    println("");
    
    success_count = 0;
    total_trials = 20;
    
    for trial in 0..total_trials {
        println("ì‹œë„ {}/{}:", trial + 1, total_trials);
        
        // Grover íšŒë¡œ ì‹¤í–‰
        grover_circuit = create_grover_5qubit();
        measurement_result = measure(grover_circuit, [0, 1, 2, 3, 4]);
        
        // ê²°ê³¼ ê²€ì¦
        verification = verify_target_state(measurement_result);
        
        if (verification.is_correct) {
            success_count = success_count + 1;
            println("  âœ… ì„±ê³µ! {} (ì‹­ì§„ìˆ˜: {})", verification.binary_string, verification.decimal);
        } else {
            println("  âŒ ì‹¤íŒ¨: {} (ì‹­ì§„ìˆ˜: {})", verification.binary_string, verification.decimal);
        }
        
        println("");
    }
    
    return {
        "success_count": success_count,
        "total_trials": total_trials,
        "success_rate": (success_count * 100) / total_trials
    };
}

fn main() {
    // ì„±ëŠ¥ í…ŒìŠ¤íŠ¸ ì‹¤í–‰
    results = run_performance_test();
    
    println("ğŸ† ìµœì¢… ì„±ê³¼:");
    println("=============");
    println("ì„±ê³µ: {} / {} ì‹œë„", results.success_count, results.total_trials);
    println("ì„±ê³µë¥ : {}%", results.success_rate);
    
    // ì„±ëŠ¥ ë¶„ì„
    if (results.success_rate >= 95) {
        println("ğŸ‰ ì™„ë²½í•œ Grover êµ¬í˜„! ì–‘ì ìš°ìœ„ í™•ë³´!");
    } else if (results.success_rate >= 85) {
        println("âœ… ì´ë¡ ì¹˜ì— ê·¼ì ‘í•œ ìš°ìˆ˜í•œ ì„±ëŠ¥!");
    } else {
        println("ğŸ”§ ì¶”ê°€ ìµœì í™” í•„ìš”");
    }
    
    println("");
    println("ğŸ“Š ì„±ëŠ¥ ë¹„êµ:");
    println("=============");
    classical_probability = 100.0 / 32;  // 3.125%
    println("â€¢ ê³ ì „ ì•Œê³ ë¦¬ì¦˜: {:.3}% (1/32)", classical_probability);
    println("â€¢ Qube Grover: {}%", results.success_rate);
    
    if (results.success_rate > 0) {
        improvement = results.success_rate / classical_probability;
        println("â€¢ ì„±ëŠ¥ í–¥ìƒ: {:.1}ë°°", improvement);
    }
    
    println("");
    println("ğŸ¯ ê¸°ìˆ ì  ì„±ê³¼:");
    println("===============");
    println("âœ… Oracleê³¼ Diffusion êµ¬ì¡° ë¶„ë¦¬");
    println("âœ… ë²”ìœ„ ë¬¸ë²• 'apply H to ~' í™œìš©");
    println("âœ… ë°˜ë³µë¬¸ìœ¼ë¡œ ì½”ë“œ ê°„ì†Œí™”");
    println("âœ… ìƒíƒœ ê²€ì¦ ì‹œìŠ¤í…œ êµ¬ì¶•");
    
    println("");
    println("âš›ï¸ ì–‘ì ì•Œê³ ë¦¬ì¦˜ ë¶„ì„:");
    println("=====================");
    println("â€¢ ì´ˆê¸° ìƒíƒœ: |00000âŸ©");
    println("â€¢ ì¤‘ì²© ìƒì„±: (1/âˆš32) Î£|xâŸ© (32ê°œ ìƒíƒœ)");
    println("â€¢ Oracle: |10101âŸ©ë§Œ ìœ„ìƒ -1ë¡œ ë§ˆí‚¹");
    println("â€¢ Diffusion: í‰ê·  ì¤‘ì‹¬ ì§„í­ ë°˜ì „");
    println("â€¢ ë°˜ë³µ 4íšŒë¡œ 99.9% í™•ë¥  ì§‘ì¤‘");
}