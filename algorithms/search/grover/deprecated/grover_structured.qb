// algorithms/search/grover_structured.qb
// êµ¬ì¡°í™”ëœ Grover ì•Œê³ ë¦¬ì¦˜ (í•¨ìˆ˜ ê¸°ë°˜)

// Oracle í•¨ìˆ˜: íŠ¹ì • ìƒíƒœë¥¼ ë§ˆí‚¹
fn apply_oracle_10101() {
    println("    ğŸ¯ Oracle: |10101âŸ© ë§ˆí‚¹");
    
    // |10101âŸ© = q4=1, q3=0, q2=1, q1=0, q0=1
    // 0ì¸ íë¹—ë“¤(q1, q3)ì„ 1ë¡œ ë³€í™˜í•˜ì—¬ |11111âŸ© ë§Œë“¤ê¸°
    apply X to q1;  // q1: 0â†’1
    apply X to q3;  // q3: 0â†’1
    
    // ëª¨ë“  íë¹—ì´ |1âŸ©ì¼ ë•Œë§Œ ìœ„ìƒ -1
    apply CZ to (q0, q1, q2, q3, q4);
    
    // ì›ìƒë³µêµ¬
    apply X to q1;  // q1: 1â†’0  
    apply X to q3;  // q3: 1â†’0
}

// Diffusion ì—°ì‚°ì: ì§„í­ ì¦í­
fn apply_diffusion() {
    println("    ğŸ”„ Diffusion: ì§„í­ ì¦í­");
    
    // |+âŸ© â†’ |0âŸ© ë³€í™˜
    apply H to ~;
    
    // |00000âŸ©ì„ ì œì™¸í•œ ëª¨ë“  ìƒíƒœì— -1 ìœ„ìƒ
    apply X to ~;   // |00000âŸ© â†’ |11111âŸ©
    apply CZ to (q0, q1, q2, q3, q4);  // |11111âŸ©ì— -1 ìœ„ìƒ
    apply X to ~;   // ì›ìƒë³µêµ¬
    
    // |0âŸ© â†’ |+âŸ© ë³€í™˜
    apply H to ~;
}

// Grover ë°˜ë³µ í•¨ìˆ˜
fn grover_iteration(iteration_num) {
    println("  --- Grover ë°˜ë³µ {}/4 ---", iteration_num);
    apply_oracle_10101();
    apply_diffusion();
}

// ì´ˆê¸°í™” í•¨ìˆ˜  
fn initialize_superposition() {
    println("ğŸš€ ì´ˆê¸°í™”: ê· ë“± ì¤‘ì²© ìƒíƒœ ìƒì„±");
    apply H to ~;  // |00000âŸ© â†’ (1/âˆš32) Î£|xâŸ©
}

// ë©”ì¸ Grover ì•Œê³ ë¦¬ì¦˜
fn create_grover_algorithm(iterations) {
    circuit GroverAlgorithm(5) {
        println("=== 5íë¹— Grover ì•Œê³ ë¦¬ì¦˜ ì‹œì‘ ===");
        
        // 1ë‹¨ê³„: ì´ˆê¸°í™”
        initialize_superposition();
        
        // 2ë‹¨ê³„: Grover ë°˜ë³µ
        println("ğŸ”„ Grover ë°˜ë³µ ì‹œì‘ (ì´ {}íšŒ)", iterations);
        
        // ë°˜ë³µ ì‹¤í–‰ (í˜„ì¬ëŠ” ìˆ˜ë™, ë‚˜ì¤‘ì— for loopìœ¼ë¡œ ê°œì„ )
        if (iterations >= 1) {
            grover_iteration(1);
        }
        if (iterations >= 2) {
            grover_iteration(2);
        }
        if (iterations >= 3) {
            grover_iteration(3);
        }
        if (iterations >= 4) {
            grover_iteration(4);
        }
        if (iterations >= 5) {
            grover_iteration(5);
        }
        if (iterations >= 6) {
            grover_iteration(6);
        }
        
        println("âœ… Grover ì•Œê³ ë¦¬ì¦˜ ì™„ë£Œ");
    }
    
    return GroverAlgorithm();
}

// ê²°ê³¼ ê²€ì¦ í•¨ìˆ˜
fn verify_result(result, target_decimal) {
    decimal = result[0] + result[1]*2 + result[2]*4 + result[3]*8 + result[4]*16;
    binary_str = "|{}{}{}{}{}âŸ©";
    
    if (decimal == target_decimal) {
        println("âœ… ì„±ê³µ! {} ë°œê²¬ (ì‹­ì§„ìˆ˜: {})", binary_str, decimal);
        return true;
    } else {
        println("âŒ ì‹¤íŒ¨: {} (ì‹­ì§„ìˆ˜: {})", binary_str, decimal);
        return false;
    }
}

// ì„±ëŠ¥ í…ŒìŠ¤íŠ¸ í•¨ìˆ˜
fn run_performance_test(iterations, trials) {
    println("ğŸ¯ Grover ì„±ëŠ¥ í…ŒìŠ¤íŠ¸");
    println("====================");
    println("ë°˜ë³µ íšŸìˆ˜: {}íšŒ", iterations);
    println("ì‹œë„ íšŸìˆ˜: {}íšŒ", trials);
    println("ëª©í‘œ ìƒíƒœ: |10101âŸ© (ì‹­ì§„ìˆ˜: 21)");
    println("");
    
    success_count = 0;
    
    trial = 1;
    while (trial <= trials) {
        println("ì‹œë„ {}/{}:", trial, trials);
        
        grover_circuit = create_grover_algorithm(iterations);
        result = measure(grover_circuit, [0, 1, 2, 3, 4]);
        
        if (verify_result(result, 21)) {
            success_count = success_count + 1;
        }
        
        trial = trial + 1;
        println("");
    }
    
    success_rate = (success_count * 100) / trials;
    
    println("ğŸ† ìµœì¢… ê²°ê³¼:");
    println("============");
    println("ì„±ê³µ: {} / {} ì‹œë„", success_count, trials);
    println("ì„±ê³µë¥ : {}%", success_rate);
    
    return success_rate;
}

// ë©”ì¸ í•¨ìˆ˜
fn main() {
    println("ğŸŒŸ êµ¬ì¡°í™”ëœ Grover ì•Œê³ ë¦¬ì¦˜ í…ŒìŠ¤íŠ¸");
    println("=================================");
    println("");
    
    // ë‹¤ì–‘í•œ ë°˜ë³µ íšŸìˆ˜ í…ŒìŠ¤íŠ¸
    println("ğŸ“Š ë°˜ë³µ íšŸìˆ˜ë³„ ì„±ëŠ¥ ë¶„ì„:");
    println("========================");
    
    // 1íšŒ ë°˜ë³µ í…ŒìŠ¤íŠ¸
    println("ğŸ”¬ 1íšŒ ë°˜ë³µ í…ŒìŠ¤íŠ¸:");
    rate_1 = run_performance_test(1, 5);
    
    println("");
    println("ğŸ”¬ 4íšŒ ë°˜ë³µ í…ŒìŠ¤íŠ¸ (ì´ë¡ ì  ìµœì ):");
    rate_4 = run_performance_test(4, 5);
    
    println("");
    println("ğŸ“ˆ ë¶„ì„ ê²°ê³¼:");
    println("=============");
    println("â€¢ 1íšŒ ë°˜ë³µ ì„±ê³µë¥ : {}%", rate_1);
    println("â€¢ 4íšŒ ë°˜ë³µ ì„±ê³µë¥ : {}%", rate_4);
    
    if (rate_4 > rate_1) {
        improvement = rate_4 - rate_1;
        println("â€¢ ì„±ëŠ¥ í–¥ìƒ: {}%p", improvement);
    }
    
    println("");
    println("ğŸ¯ êµ¬ì¡°í™”ì˜ ì¥ì :");
    println("================");
    println("âœ… Oracleê³¼ Diffusion ëª…í™•íˆ ë¶„ë¦¬");
    println("âœ… ë°˜ë³µ íšŸìˆ˜ ìœ ì—°í•˜ê²Œ ì¡°ì • ê°€ëŠ¥");
    println("âœ… ì½”ë“œ ì¬ì‚¬ìš©ì„± ê·¹ëŒ€í™”");
    println("âœ… ë””ë²„ê¹… ë° ìµœì í™” ìš©ì´");
}