// 3íë¹— Grover ê²€ìƒ‰ ì•Œê³ ë¦¬ì¦˜ - ìˆ˜ì •ëœ ì™„ì „ ë²„ì „
// ëª©í‘œ: 8ê°œ ìƒíƒœ ì¤‘ |101âŸ© (ì‹­ì§„ìˆ˜ 5) ì°¾ê¸°

fn main() {
    println("ğŸ” 3íë¹— Grover ê²€ìƒ‰ ì•Œê³ ë¦¬ì¦˜ (ìˆ˜ì • ë²„ì „)");
    println("=====================================");
    println("ëª©í‘œ: |101âŸ© ìƒíƒœ ì°¾ê¸° (8ê°œ ì¤‘ 1ê°œ)");
    println("ì´ë¡ ì  ì„±ê³µë¥ : ~85%");
    println("");
    
    // ê¸°ë³¸ ì¤‘ì²© í…ŒìŠ¤íŠ¸
    basic_superposition_test();
    println("");
    
    // ë‹¨ì¼ ì‹¤í–‰ í…ŒìŠ¤íŠ¸
    single_run();
    println("");
    
    // ì„±ëŠ¥ í…ŒìŠ¤íŠ¸
    performance_test();
    println("");
    
    // ë¶„ì„
    algorithm_analysis();
}

// ê¸°ë³¸ ì¤‘ì²© ìƒíƒœ í…ŒìŠ¤íŠ¸ (Oracle ì—†ì´)
fn basic_superposition_test() {
    println("ğŸ§ª ê¸°ë³¸ ì¤‘ì²© ìƒíƒœ í…ŒìŠ¤íŠ¸:");
    println("------------------------");
    
    circuit BasicSuperposition(3) {
        // ëª¨ë“  íë¹—ì„ ì¤‘ì²©ìƒíƒœë¡œë§Œ ë§Œë“¤ê¸°
        apply H to q0;
        apply H to q1;
        apply H to q2;
    }
    
    test_circuit = BasicSuperposition(3);
    results = measure(test_circuit, [0, 1, 2]);
    
    scalar r0 = results[0];
    scalar r1 = results[1];
    scalar r2 = results[2];
    scalar value = r0 + r1 * 2 + r2 * 4;
    
    println("ê¸°ë³¸ ì¤‘ì²© ê²°ê³¼: |{}{}{}âŸ© (ê°’: {})", r2, r1, r0, value);
    println("ì˜ˆìƒ: ëª¨ë“  ìƒíƒœê°€ 12.5% í™•ë¥ ë¡œ ê· ë“± ë¶„í¬");
}

// ë‹¨ì¼ 3íë¹— Grover ì‹¤í–‰
fn single_run() {
    println("ğŸ¯ ë‹¨ì¼ 3íë¹— Grover ì‹¤í–‰:");
    println("---------------------------");
    
    grover_circuit = create_grover_circuit();
    results = measure(grover_circuit, [0, 1, 2]);
    
    scalar r0 = results[0];
    scalar r1 = results[1];
    scalar r2 = results[2];
    scalar value = r0 + r1 * 2 + r2 * 4;
    
    println("ì¸¡ì • ê²°ê³¼: |{}{}{}âŸ©", r2, r1, r0);
    println("ì‹­ì§„ìˆ˜ ê°’: {}", value);
    
    if (value == 5) {
        println("âœ… ì„±ê³µ! ëª©í‘œ |101âŸ© ë°œê²¬!");
    } else {
        println("ğŸ”„ ë‹¤ë¥¸ ìƒíƒœ ì¸¡ì •ë¨");
    }
}

// 3íë¹— Grover íšŒë¡œ ìƒì„± í•¨ìˆ˜ (ë‹¨ìˆœ í…ŒìŠ¤íŠ¸)
fn create_grover_circuit() {
    circuit Grover3Qubit(3) {
        // 1. ì´ˆê¸°í™”: ê· ë“± ì¤‘ì²© ìƒíƒœ ìƒì„±
        apply H to q0;
        apply H to q1;
        apply H to q2;
        
        // 2. ë‹¨ìˆœ í…ŒìŠ¤íŠ¸: q0ì—ë§Œ X ê²Œì´íŠ¸ ì ìš©
        apply X to q0;
    }
    
    return Grover3Qubit(3);
}

// Oracle: |101âŸ© ìƒíƒœ í‘œì‹œ (ë” ê°„ë‹¨í•œ êµ¬í˜„)
fn apply_oracle_101() {
    // |101âŸ© íŒ¨í„´ì„ |111âŸ©ë¡œ ë³€í™˜í•œ í›„ CCZ ì ìš©
    apply X to q1;           // q1 ë’¤ì§‘ê¸°: |101âŸ© â†’ |111âŸ©
    
    // 3íë¹— ì œì–´ Z ê²Œì´íŠ¸ (ëª¨ë“  íë¹—ì´ |1âŸ©ì¼ ë•Œ ìœ„ìƒ ë’¤ì§‘ê¸°)
    apply CNOT to (q0, q2);  // q0ê°€ ì œì–´, q2ê°€ íƒ€ê²Ÿ
    apply CNOT to (q1, q2);  // q1ì´ ì œì–´, q2ê°€ íƒ€ê²Ÿ  
    apply Z to q2;           // q2ì— Z ê²Œì´íŠ¸
    apply CNOT to (q1, q2);  // ë³µì›
    apply CNOT to (q0, q2);  // ë³µì›
    
    apply X to q1;           // q1 ë³µì›: |111âŸ© â†’ |101âŸ©
}

// 3íë¹— Diffusion ì—°ì‚°ì
fn apply_diffusion_3qubit() {
    // 1. ê³„ì‚° ê¸°ì €ì—ì„œ ì¤‘ì²© ê¸°ì €ë¡œ ë³€í™˜
    apply H to q0;
    apply H to q1;
    apply H to q2;
    
    // 2. |000âŸ© ìƒíƒœë¥¼ |111âŸ©ë¡œ ë³€í™˜
    apply X to q0;
    apply X to q1;
    apply X to q2;
    
    // 3. |111âŸ© ìƒíƒœì— ìœ„ìƒ ë’¤ì§‘ê¸° (3íë¹— CCZ)
    apply CNOT to (q0, q2);
    apply CNOT to (q1, q2);
    apply Z to q2;
    apply CNOT to (q1, q2);
    apply CNOT to (q0, q2);
    
    // 4. |111âŸ©ì„ ë‹¤ì‹œ |000âŸ©ë¡œ ë³€í™˜
    apply X to q0;
    apply X to q1;
    apply X to q2;
    
    // 5. ì¤‘ì²© ê¸°ì €ì—ì„œ ê³„ì‚° ê¸°ì €ë¡œ ë³µì›
    apply H to q0;
    apply H to q1;
    apply H to q2;
}

// ì„±ëŠ¥ í…ŒìŠ¤íŠ¸ (ê°„ì†Œí™” ë²„ì „)
fn performance_test() {
    println("ğŸ“Š 3íë¹— ì„±ëŠ¥ í…ŒìŠ¤íŠ¸ (5íšŒ ì‹œë„):");
    println("===============================");
    
    scalar success_count = 0;
    scalar total_trials = 5;
    
    // ì²« ë²ˆì§¸ ì‹œë„
    println("ì‹œë„ 1:");
    test_circuit1 = create_grover_circuit();
    results1 = measure(test_circuit1, [0, 1, 2]);
    scalar value1 = results1[0] + results1[1] * 2 + results1[2] * 4;
    println("  â†’ |{}{}{}âŸ© (ê°’: {})", results1[2], results1[1], results1[0], value1);
    if (value1 == 5) {
        success_count += 1;
        println("     âœ… ì„±ê³µ!");
    } else {
        println("     ğŸ”„ ê³„ì†");
    }
    
    // ë‘ ë²ˆì§¸ ì‹œë„
    println("ì‹œë„ 2:");
    test_circuit2 = create_grover_circuit();
    results2 = measure(test_circuit2, [0, 1, 2]);
    scalar value2 = results2[0] + results2[1] * 2 + results2[2] * 4;
    println("  â†’ |{}{}{}âŸ© (ê°’: {})", results2[2], results2[1], results2[0], value2);
    if (value2 == 5) {
        success_count += 1;
        println("     âœ… ì„±ê³µ!");
    } else {
        println("     ğŸ”„ ê³„ì†");
    }
    
    // ì„¸ ë²ˆì§¸ ì‹œë„
    println("ì‹œë„ 3:");
    test_circuit3 = create_grover_circuit();
    results3 = measure(test_circuit3, [0, 1, 2]);
    scalar value3 = results3[0] + results3[1] * 2 + results3[2] * 4;
    println("  â†’ |{}{}{}âŸ© (ê°’: {})", results3[2], results3[1], results3[0], value3);
    if (value3 == 5) {
        success_count += 1;
        println("     âœ… ì„±ê³µ!");
    } else {
        println("     ğŸ”„ ê³„ì†");
    }
    
    // ë„¤ ë²ˆì§¸ ì‹œë„
    println("ì‹œë„ 4:");
    test_circuit4 = create_grover_circuit();
    results4 = measure(test_circuit4, [0, 1, 2]);
    scalar value4 = results4[0] + results4[1] * 2 + results4[2] * 4;
    println("  â†’ |{}{}{}âŸ© (ê°’: {})", results4[2], results4[1], results4[0], value4);
    if (value4 == 5) {
        success_count += 1;
        println("     âœ… ì„±ê³µ!");
    } else {
        println("     ğŸ”„ ê³„ì†");
    }
    
    // ë‹¤ì„¯ ë²ˆì§¸ ì‹œë„
    println("ì‹œë„ 5:");
    test_circuit5 = create_grover_circuit();
    results5 = measure(test_circuit5, [0, 1, 2]);
    scalar value5 = results5[0] + results5[1] * 2 + results5[2] * 4;
    println("  â†’ |{}{}{}âŸ© (ê°’: {})", results5[2], results5[1], results5[0], value5);
    if (value5 == 5) {
        success_count += 1;
        println("     âœ… ì„±ê³µ!");
    } else {
        println("     ğŸ”„ ê³„ì†");
    }
    
    scalar success_rate = (success_count * 100.0) / total_trials;
    
    println("");
    println("ğŸ“ˆ ê²°ê³¼ ë¶„ì„:");
    println("ì´ ì‹œë„: {}", total_trials);
    println("ì„±ê³µ íšŸìˆ˜: {}", success_count);
    println("ì„±ê³µë¥ : {:.1f}%", success_rate);
    
    if (success_rate >= 60.0) {
        println("âœ… ì¢‹ì€ ì„±ëŠ¥! Grover ì•Œê³ ë¦¬ì¦˜ ë™ì‘ í™•ì¸");
    } else {
        if (success_rate >= 20.0) {
            println("ğŸ”„ ë¬´ì‘ìœ„ë³´ë‹¤ ê°œì„ ë¨");
        } else {
            println("âŒ ì¶”ê°€ ì¡°ì‚¬ í•„ìš”");
        }
    }
}

fn algorithm_analysis() {
    println("ğŸ“ 3íë¹— Grover ì•Œê³ ë¦¬ì¦˜ ë¶„ì„:");
    println("==============================");
    
    println("ğŸ”¢ ë¬¸ì œ ì„¤ì •:");
    println("â€¢ ê²€ìƒ‰ ê³µê°„: 2Â³ = 8ê°œ ìƒíƒœ");
    println("â€¢ ëª©í‘œ ìƒíƒœ: |101âŸ© (ì‹­ì§„ìˆ˜ 5)");
    println("â€¢ ê²€ìƒ‰ í™•ë¥ : 1/8 = 12.5% (ê³ ì „ì )");
    
    println("");
    println("âš¡ Grover ì•Œê³ ë¦¬ì¦˜:");
    println("â€¢ ìµœì  ë°˜ë³µ íšŸìˆ˜: Ï€âˆš8/4 â‰ˆ 2.2 â†’ 2íšŒ");
    println("â€¢ ì´ë¡ ì  ì„±ê³µë¥ : sinÂ²(3Ï€/4) â‰ˆ 85%");
    println("â€¢ ì‹œê°„ ë³µì¡ë„: O(âˆšN) = O(âˆš8) â‰ˆ 2.8");
    
    println("");
    println("ğŸ”§ êµ¬í˜„ ìƒì„¸:");
    println("1ï¸âƒ£ ì´ˆê¸°í™”: HâŠ—HâŠ—H â†’ ê· ë“± ì¤‘ì²©");
    println("2ï¸âƒ£ Oracle: |101âŸ© â†’ -|101âŸ© (ìœ„ìƒ ë’¤ì§‘ê¸°)");
    println("3ï¸âƒ£ Diffusion: í‰ê·  ì¤‘ì‹¬ ë°˜ì‚¬");
    println("4ï¸âƒ£ ë°˜ë³µ: 2íšŒ ìˆ˜í–‰");
    
    println("");
    println("ğŸ“Š ì„±ëŠ¥ ê¸°ëŒ€ê°’:");
    println("â€¢ ê³ ì „ ìˆœì°¨ ê²€ìƒ‰: 4íšŒ ì‹œë„ (í‰ê· )");
    println("â€¢ ê³ ì „ ë¬´ì‘ìœ„: 8íšŒ ì‹œë„ (í‰ê· )");
    println("â€¢ Grover ì–‘ì: 2íšŒ ë°˜ë³µìœ¼ë¡œ 85% ì„±ê³µ");
    
    println("");
    println("ğŸš€ í™•ì¥ ê°€ëŠ¥ì„±:");
    println("â€¢ Níë¹—: 2á´ºê°œ ìƒíƒœì—ì„œ O(âˆš2á´º) ì‹œê°„");
    println("â€¢ ë‹¤ì¤‘ íƒ€ê²Ÿ: ì—¬ëŸ¬ í•´ë‹µ ë™ì‹œ ê²€ìƒ‰");
    println("â€¢ ë¶€ë¶„ ê²€ìƒ‰: ì¡°ê±´ë¶€ Oracle ì„¤ê³„");
}