// grover_debug.qb
// 5íë¹— Grover ì•Œê³ ë¦¬ì¦˜ ìƒì„¸ ë””ë²„ê¹…
// ê° ë‹¨ê³„ë³„ ìƒíƒœ ë²¡í„° ë¶„ì„

fn create_debug_grover() {
    circuit DebugGrover5Qubit(5) {
        println("ğŸ” ë‹¨ê³„ë³„ Grover ë””ë²„ê¹…:");
        println("=========================");
        
        // 1. ì´ˆê¸°í™”: ê· ë“± ì¤‘ì²©
        println("1ï¸âƒ£ ì´ˆê¸°í™” (HâŠ—5):");
        apply H to q0;
        apply H to q1; 
        apply H to q2;
        apply H to q3;
        apply H to q4;
        // ì˜ˆìƒ: ëª¨ë“  32ê°œ ìƒíƒœê°€ 1/32 = 3.125%
        
        println("");
        println("2ï¸âƒ£ ì²« ë²ˆì§¸ Grover ë°˜ë³µ:");
        println("------------------------");
        
        // Oracle: |10101âŸ© í‘œì‹œ (q4=1, q3=0, q2=1, q1=0, q0=1)
        println("2-1) Oracle ì ìš© ì „ ìƒíƒœ í™•ì¸");
        println("Oracle ëŒ€ìƒ: |10101âŸ© = q4=1, q3=0, q2=1, q1=0, q0=1");
        
        apply X to q3;  // q3: 0â†’1 ë³€í™˜
        apply X to q1;  // q1: 0â†’1 ë³€í™˜
        println("2-2) X ê²Œì´íŠ¸ ì ìš© í›„ (q3, q1 ë’¤ì§‘ê¸°)");
        
        apply CZ to (q4, q3, q2, q1, q0);  // ëª¨ë“  íë¹—ì´ 1ì¼ ë•Œ phase flip
        println("2-3) CZ ê²Œì´íŠ¸ ì ìš© í›„ (Phase Flip)");
        
        apply X to q1;  // q1 ë³µì›
        apply X to q3;  // q3 ë³µì›
        println("2-4) Oracle ì™„ë£Œ (X ê²Œì´íŠ¸ ë³µì›)");
        
        // Diffusion ì—°ì‚°ì
        println("2-5) Diffusion ì—°ì‚°ì ì‹œì‘");
        apply H to q0; apply H to q1; apply H to q2; apply H to q3; apply H to q4;
        println("2-6) H ê²Œì´íŠ¸ ì ìš© í›„");
        
        apply X to q0; apply X to q1; apply X to q2; apply X to q3; apply X to q4;
        println("2-7) X ê²Œì´íŠ¸ ì ìš© í›„");
        
        apply CZ to (q4, q3, q2, q1, q0);  // |11111âŸ©ì— phase flip
        println("2-8) CZ ê²Œì´íŠ¸ ì ìš© í›„");
        
        apply X to q0; apply X to q1; apply X to q2; apply X to q3; apply X to q4;
        apply H to q0; apply H to q1; apply H to q2; apply H to q3; apply H to q4;
        println("2-9) ì²« ë²ˆì§¸ Grover ë°˜ë³µ ì™„ë£Œ");
        println("");
        
        // ë‘ ë²ˆì§¸ ë°˜ë³µ
        println("3ï¸âƒ£ ë‘ ë²ˆì§¸ Grover ë°˜ë³µ:");
        apply X to q3; apply X to q1;
        apply CZ to (q4, q3, q2, q1, q0);
        apply X to q1; apply X to q3;
        
        apply H to q0; apply H to q1; apply H to q2; apply H to q3; apply H to q4;
        apply X to q0; apply X to q1; apply X to q2; apply X to q3; apply X to q4;
        apply CZ to (q4, q3, q2, q1, q0);
        apply X to q0; apply X to q1; apply X to q2; apply X to q3; apply X to q4;
        apply H to q0; apply H to q1; apply H to q2; apply H to q3; apply H to q4;
        println("3-1) ë‘ ë²ˆì§¸ Grover ë°˜ë³µ ì™„ë£Œ");
        println("");
        
        // ì„¸ ë²ˆì§¸ ë°˜ë³µ
        println("4ï¸âƒ£ ì„¸ ë²ˆì§¸ Grover ë°˜ë³µ:");
        apply X to q3; apply X to q1;
        apply CZ to (q4, q3, q2, q1, q0);
        apply X to q1; apply X to q3;
        
        apply H to q0; apply H to q1; apply H to q2; apply H to q3; apply H to q4;
        apply X to q0; apply X to q1; apply X to q2; apply X to q3; apply X to q4;
        apply CZ to (q4, q3, q2, q1, q0);
        apply X to q0; apply X to q1; apply X to q2; apply X to q3; apply X to q4;
        apply H to q0; apply H to q1; apply H to q2; apply H to q3; apply H to q4;
        println("4-1) ì„¸ ë²ˆì§¸ Grover ë°˜ë³µ ì™„ë£Œ");
        println("");
        
        // ë„¤ ë²ˆì§¸ ë°˜ë³µ
        println("5ï¸âƒ£ ë„¤ ë²ˆì§¸ Grover ë°˜ë³µ:");
        apply X to q3; apply X to q1;
        apply CZ to (q4, q3, q2, q1, q0);
        apply X to q1; apply X to q3;
        
        apply H to q0; apply H to q1; apply H to q2; apply H to q3; apply H to q4;
        apply X to q0; apply X to q1; apply X to q2; apply X to q3; apply X to q4;
        apply CZ to (q4, q3, q2, q1, q0);
        apply X to q0; apply X to q1; apply X to q2; apply X to q3; apply X to q4;
        apply H to q0; apply H to q1; apply H to q2; apply H to q3; apply H to q4;
        println("5-1) ë„¤ ë²ˆì§¸ Grover ë°˜ë³µ ì™„ë£Œ");
        println("");
        
        println("6ï¸âƒ£ ìµœì¢… ìƒíƒœ ë¶„ì„:");
        println("ëª©í‘œ: |10101âŸ© í™•ë¥ ì´ 85%ì— ê°€ê¹Œì›Œì•¼ í•¨");
        println("í˜„ì¬: 8ê°œ ìƒíƒœê°€ ê°ê° 12.5%ì”© (ë¬¸ì œ!)");
    }
    return DebugGrover5Qubit(5);
}

fn analyze_oracle() {
    println("");
    println("ğŸ”¬ Oracle ë¶„ì„:");
    println("================");
    
    circuit OracleTest(5) {
        // ì´ˆê¸°í™”
        apply H to q0; apply H to q1; apply H to q2; apply H to q3; apply H to q4;
        
        println("Oracle í…ŒìŠ¤íŠ¸: |10101âŸ© ìƒíƒœë§Œ phase flipí•´ì•¼ í•¨");
        
        // Oracle for |10101âŸ©
        apply X to q3;  // q3=0ì„ 1ë¡œ ë³€í™˜
        apply X to q1;  // q1=0ì„ 1ë¡œ ë³€í™˜
        apply CZ to (q4, q3, q2, q1, q0);  
        apply X to q1;  // ë³µì›
        apply X to q3;  // ë³µì›
        
        println("Oracle ì ìš© ì™„ë£Œ");
    }
    
    oracle_circuit = OracleTest(5);
    println("Oracle ë‹¨ë… í…ŒìŠ¤íŠ¸ ì™„ë£Œ");
}

fn main() {
    println("ğŸš€ 5íë¹— Grover ìƒì„¸ ë””ë²„ê¹…");
    println("============================");
    
    // Oracle ë‹¨ë… í…ŒìŠ¤íŠ¸
    analyze_oracle();
    
    println("");
    println("ğŸ” ì „ì²´ Grover ë””ë²„ê¹…:");
    
    // ë””ë²„ê·¸ ëª¨ë“œë¡œ ì‹¤í–‰
    debug_circuit = create_debug_grover();
    result = measure(debug_circuit, [0, 1, 2, 3, 4]);
    
    decimal_value = result[0] + result[1]*2 + result[2]*4 + result[3]*8 + result[4]*16;
    
    println("");
    println("ğŸ“Š ì¸¡ì • ê²°ê³¼:");
    println("=============");
    if (decimal_value == 21) {  // |10101âŸ©
        println("âœ… ì„±ê³µ! |10101âŸ© ìƒíƒœ ë°œê²¬ (21)");
    } else {
        println("âŒ ì‹¤íŒ¨: ë‹¤ë¥¸ ìƒíƒœ ì¸¡ì •ë¨ ({})", decimal_value);
    }
    
    println("");
    println("ğŸ¯ ì˜ˆìƒ ë¬¸ì œì :");
    println("===============");
    println("1. Oracleì´ ì •í™•íˆ |10101âŸ©ë§Œ phase flipí•˜ëŠ”ê°€?");
    println("2. Diffusionì´ ì˜¬ë°”ë¥´ê²Œ í‰ê· ê°’ ê¸°ë°˜ ì¦í­í•˜ëŠ”ê°€?");
    println("3. 4íšŒ ë°˜ë³µì´ 5íë¹—ì— ìµœì ì¸ê°€?");
    println("");
    println("ë‹¤ìŒ: Oracle ì •í™•ì„± ê²€ì¦ í•„ìš”");
}