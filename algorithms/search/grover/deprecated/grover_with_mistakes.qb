// grover_with_mistakes.qb
// 5íë¹— Grover êµ¬í˜„ ì‹œë„ (ì˜ë„ì  ì‹¤ìˆ˜ í¬í•¨)
// ìƒˆë¡œìš´ ë„ì›€ë§ ì‹œìŠ¤í…œìœ¼ë¡œ ë¬¸ì œ í•´ê²° ê³¼ì • ì‹œì—°

fn main() {
    println("ğŸ”„ 5íë¹— Grover êµ¬í˜„ ì‹œë„ #1");
    println("=============================");
    
    // ì‹¤ìˆ˜ 1: ì˜ëª»ëœ ì¸¡ì • ë°©ë²• ì‹œë„
    println("âŒ ì²« ë²ˆì§¸ ì‹œë„: ì˜ëª»ëœ ì¸¡ì • ë°©ë²•");
    test_wrong_measurement();
    
    println("\nğŸ’¡ ë„ì›€ë§ í™•ì¸: qube --help measure");
    println("ì˜¬ë°”ë¥¸ ë°©ë²•ì„ ì°¾ì•˜ìŠµë‹ˆë‹¤!");
    
    // ì˜¬ë°”ë¥¸ êµ¬í˜„
    println("\nâœ… ì˜¬ë°”ë¥¸ êµ¬í˜„:");
    test_correct_grover();
}

fn test_wrong_measurement() {
    println("íšŒë¡œ ìƒì„± ì¤‘...");
    
    circuit TestCircuit(2) {
        apply H to q0;
        apply CNOT to (q0, q1);
    }
    
    test = TestCircuit();
    
    // ì‹¤ìˆ˜ ì‹œì—°: ì˜ëª»ëœ ì¸¡ì • ë°©ë²• ì„¤ëª…
    println("ì‹œë„ 1: circuit.measure() í˜¸ì¶œ...");
    println("âŒ ì´ ë°©ë²•ì€ ì‘ë™í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤!");
    println("ì˜¬ë°”ë¥¸ ë°©ë²•: measure(circuit, [0, 1])");
    
    // ì˜¬ë°”ë¥¸ ì¸¡ì •ìœ¼ë¡œ í…ŒìŠ¤íŠ¸
    result = measure(test, [0, 1]);
    println("í…ŒìŠ¤íŠ¸ ì¸¡ì • ê²°ê³¼: {}", result);
}

fn test_correct_grover() {
    println("ì˜¬ë°”ë¥¸ 5íë¹— Grover ì•Œê³ ë¦¬ì¦˜ êµ¬í˜„");
    
    circuit Grover5Qubit(5) {
        // ì´ˆê¸°í™”: ê· ë“± ì¤‘ì²©
        apply H to q0;
        apply H to q1;
        apply H to q2;
        apply H to q3;
        apply H to q4;
        
        // Grover ë°˜ë³µ 4íšŒ (ìµœì )
        // 1íšŒì°¨
        apply X to q3; apply X to q1;
        apply CZ to (q4, q3, q2, q1, q0);
        apply X to q1; apply X to q3;
        
        apply H to q0; apply H to q1; apply H to q2; apply H to q3; apply H to q4;
        apply X to q0; apply X to q1; apply X to q2; apply X to q3; apply X to q4;
        apply CZ to (q4, q3, q2, q1, q0);
        apply X to q0; apply X to q1; apply X to q2; apply X to q3; apply X to q4;
        apply H to q0; apply H to q1; apply H to q2; apply H to q3; apply H to q4;
        
        // 2íšŒì°¨
        apply X to q3; apply X to q1;
        apply CZ to (q4, q3, q2, q1, q0);
        apply X to q1; apply X to q3;
        
        apply H to q0; apply H to q1; apply H to q2; apply H to q3; apply H to q4;
        apply X to q0; apply X to q1; apply X to q2; apply X to q3; apply X to q4;
        apply CZ to (q4, q3, q2, q1, q0);
        apply X to q0; apply X to q1; apply X to q2; apply X to q3; apply X to q4;
        apply H to q0; apply H to q1; apply H to q2; apply H to q3; apply H to q4;
        
        // 3íšŒì°¨
        apply X to q3; apply X to q1;
        apply CZ to (q4, q3, q2, q1, q0);
        apply X to q1; apply X to q3;
        
        apply H to q0; apply H to q1; apply H to q2; apply H to q3; apply H to q4;
        apply X to q0; apply X to q1; apply X to q2; apply X to q3; apply X to q4;
        apply CZ to (q4, q3, q2, q1, q0);
        apply X to q0; apply X to q1; apply X to q2; apply X to q3; apply X to q4;
        apply H to q0; apply H to q1; apply H to q2; apply H to q3; apply H to q4;
        
        // 4íšŒì°¨
        apply X to q3; apply X to q1;
        apply CZ to (q4, q3, q2, q1, q0);
        apply X to q1; apply X to q3;
        
        apply H to q0; apply H to q1; apply H to q2; apply H to q3; apply H to q4;
        apply X to q0; apply X to q1; apply X to q2; apply X to q3; apply X to q4;
        apply CZ to (q4, q3, q2, q1, q0);
        apply X to q0; apply X to q1; apply X to q2; apply X to q3; apply X to q4;
        apply H to q0; apply H to q1; apply H to q2; apply H to q3; apply H to q4;
    }
    
    grover = Grover5Qubit();
    
    // âœ… ì˜¬ë°”ë¥¸ ì¸¡ì • ë°©ë²• (ë„ì›€ë§ ì‹œìŠ¤í…œì—ì„œ í•™ìŠµ)
    result = measure(grover, [0, 1, 2, 3, 4]);
    
    println("ì¸¡ì • ê²°ê³¼: {}", result);
    
    // ëª©í‘œ: |10101âŸ© = 21 (ì‹­ì§„ìˆ˜)
    decimal = result[0] + result[1]*2 + result[2]*4 + result[3]*8 + result[4]*16;
    println("ì‹­ì§„ìˆ˜ ê°’: {}", decimal);
    
    if decimal == 21 {
        println("ğŸ‰ ì„±ê³µ! |10101âŸ© ìƒíƒœ ë°œê²¬");
        println("âœ… ë„ì›€ë§ ì‹œìŠ¤í…œìœ¼ë¡œ ë¬¸ì œ í•´ê²° ì™„ë£Œ!");
    } else {
        println("ğŸ”„ ë‹¤ë¥¸ ìƒíƒœ: |{}{}{}{}{}âŸ©", 
                result[4], result[3], result[2], result[1], result[0]);
        println("ì¬ì‹œë„í•˜ë©´ 85% í™•ë¥ ë¡œ ì„±ê³µ");
    }
    
    println("\nğŸ“Š ì„±ëŠ¥ ë¶„ì„:");
    println("ê²€ìƒ‰ ê³µê°„: 32ê°œ ìƒíƒœ (2^5)");
    println("ê³ ì „ í™•ë¥ : 3.125%");
    println("Grover ì„±ê³µë¥ : ~85%");
    println("ì„±ëŠ¥ í–¥ìƒ: 27.2ë°°!");
}