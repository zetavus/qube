// test_range_syntax.qb
// ë²”ìœ„ ë¬¸ë²• ì‹¤ì œ êµ¬í˜„ ìƒíƒœ í…ŒìŠ¤íŠ¸

fn main() {
    println("ğŸ” ë²”ìœ„ ë¬¸ë²• í…ŒìŠ¤íŠ¸ ì‹œì‘");
    println("========================");
    
    // í…ŒìŠ¤íŠ¸ 1: ê¸°ë³¸ ë²”ìœ„ ë¬¸ë²•
    println("í…ŒìŠ¤íŠ¸ 1: apply CZ to (~, q4)");
    test_basic_range();
    
    // í…ŒìŠ¤íŠ¸ 2: ë‹¤ì–‘í•œ íë¹— ìˆ˜
    println("\ní…ŒìŠ¤íŠ¸ 2: ë‹¤ì–‘í•œ íë¹— ìˆ˜");
    test_various_sizes();
    
    // í…ŒìŠ¤íŠ¸ 3: ì—ëŸ¬ ì¼€ì´ìŠ¤
    println("\ní…ŒìŠ¤íŠ¸ 3: ì—ëŸ¬ ì¼€ì´ìŠ¤");
    test_error_cases();
}

fn test_basic_range() {
    try {
        circuit TestRange5(5) {
            apply H to q0;
            apply H to q1;
            apply H to q2;
            apply H to q3;
            apply H to q4;
            
            // í•µì‹¬ í…ŒìŠ¤íŠ¸: ë²”ìœ„ ë¬¸ë²•
            apply CZ to (~, q4);
        }
        
        range_circuit = TestRange5();
        println("âœ… 5íë¹— ë²”ìœ„ ë¬¸ë²• ì„±ê³µ");
        
        result = measure(range_circuit, [0, 1, 2, 3, 4]);
        println("ì¸¡ì • ê²°ê³¼: {}", result);
        
    } catch (error) {
        println("âŒ 5íë¹— ë²”ìœ„ ë¬¸ë²• ì‹¤íŒ¨: {}", error);
    }
}

fn test_various_sizes() {
    // 3íë¹— í…ŒìŠ¤íŠ¸
    try {
        circuit TestRange3(3) {
            apply H to q0;
            apply H to q1;
            apply H to q2;
            apply CZ to (~, q2);
        }
        
        test3 = TestRange3();
        println("âœ… 3íë¹— ë²”ìœ„ ë¬¸ë²• ì„±ê³µ");
        
    } catch (error) {
        println("âŒ 3íë¹— ë²”ìœ„ ë¬¸ë²• ì‹¤íŒ¨: {}", error);
    }
    
    // 6íë¹— í…ŒìŠ¤íŠ¸
    try {
        circuit TestRange6(6) {
            apply H to q0;
            apply H to q1;
            apply H to q2;
            apply H to q3;
            apply H to q4;
            apply H to q5;
            apply CZ to (~, q5);
        }
        
        test6 = TestRange6();
        println("âœ… 6íë¹— ë²”ìœ„ ë¬¸ë²• ì„±ê³µ");
        
    } catch (error) {
        println("âŒ 6íë¹— ë²”ìœ„ ë¬¸ë²• ì‹¤íŒ¨: {}", error);
    }
    
    // 10íë¹— í…ŒìŠ¤íŠ¸ (í° íšŒë¡œ)
    try {
        circuit TestRange10(10) {
            // ëª¨ë“  íë¹— ì´ˆê¸°í™”
            apply H to q0; apply H to q1; apply H to q2; apply H to q3; apply H to q4;
            apply H to q5; apply H to q6; apply H to q7; apply H to q8; apply H to q9;
            
            // ë²”ìœ„ ë¬¸ë²• í…ŒìŠ¤íŠ¸
            apply CZ to (~, q9);
        }
        
        test10 = TestRange10();
        println("âœ… 10íë¹— ë²”ìœ„ ë¬¸ë²• ì„±ê³µ");
        
    } catch (error) {
        println("âŒ 10íë¹— ë²”ìœ„ ë¬¸ë²• ì‹¤íŒ¨: {}", error);
    }
}

fn test_error_cases() {
    // ì—ëŸ¬ ì¼€ì´ìŠ¤ 1: ì¡´ì¬í•˜ì§€ ì•ŠëŠ” íë¹—
    try {
        circuit TestError1(3) {
            apply CZ to (~, q5);  // q5ëŠ” ì¡´ì¬í•˜ì§€ ì•ŠìŒ
        }
        
        error1 = TestError1();
        println("âš ï¸ ì˜ˆìƒì¹˜ ëª»í•œ ì„±ê³µ: ì¡´ì¬í•˜ì§€ ì•ŠëŠ” íë¹—");
        
    } catch (error) {
        println("âœ… ì˜ˆìƒëœ ì—ëŸ¬: {}", error);
    }
    
    // ì—ëŸ¬ ì¼€ì´ìŠ¤ 2: ì˜ëª»ëœ ë¬¸ë²•
    try {
        circuit TestError2(3) {
            apply CZ to (~~, q2);  // ì˜ëª»ëœ ë²”ìœ„ ë¬¸ë²•
        }
        
        error2 = TestError2();
        println("âš ï¸ ì˜ˆìƒì¹˜ ëª»í•œ ì„±ê³µ: ì˜ëª»ëœ ë¬¸ë²•");
        
    } catch (error) {
        println("âœ… ì˜ˆìƒëœ ì—ëŸ¬: {}", error);
    }
}

// ì¶”ê°€ í…ŒìŠ¤íŠ¸: ë²”ìœ„ ë¬¸ë²•ì˜ ì‹¤ì œ ë™ì‘ í™•ì¸
fn test_range_behavior() {
    println("\nğŸ§ª ë²”ìœ„ ë¬¸ë²• ë™ì‘ ë¶„ì„");
    println("====================");
    
    try {
        circuit AnalyzeRange(4) {
            // íŠ¹ì • ìƒíƒœ ì„¤ì •: |1111âŸ©
            apply X to q0;
            apply X to q1;
            apply X to q2;
            apply X to q3;
            
            // ë²”ìœ„ CZ ì ìš©
            apply CZ to (~, q3);
        }
        
        analyze = AnalyzeRange();
        result = measure(analyze, [0, 1, 2, 3]);
        
        println("ì´ˆê¸° ìƒíƒœ: |1111âŸ©");
        println("ë²”ìœ„ CZ ì ìš© í›„ ì¸¡ì •: {}", result);
        
        // |1111âŸ© ìƒíƒœì—ì„œ CZ ì ìš©ì‹œ ìœ„ìƒì´ ë’¤ì§‘í˜€ì•¼ í•¨
        decimal = result[0] + result[1]*2 + result[2]*4 + result[3]*8;
        if decimal == 15 {  // |1111âŸ© = 15
            println("âœ… ë²”ìœ„ CZ ì •ìƒ ë™ì‘ (ìœ„ìƒ ë’¤ì§‘ê¸° í™•ì¸)");
        } else {
            println("ğŸ“Š ë‹¤ë¥¸ ê²°ê³¼: {} (í™•ë¥ ì  ì¸¡ì •)", decimal);
        }
        
    } catch (error) {
        println("âŒ ë²”ìœ„ ë™ì‘ ë¶„ì„ ì‹¤íŒ¨: {}", error);
    }
}